<section class="k-dialog-body">
  <p class="text-muted mb-2">
    The user will be sent a URL via email to complete registration. They will be
    prompted to enter the rest of their information such as phone number and fax
    number after they register.
  </p>
  <form [formGroup]="userFormGroup">
    <div class="flex-row">
      <div class="flex-col">
        <h5>User Access Type</h5>
        <div class="component-list-h">
          <span class="app-radiobtnwidtext-wrapper">
            <input type="radio" [(ngModel)]="userAccessType" id="internalUserAccessType" value="INTERNAL" aria-labelledby="Internal" kendoRadioButton name="userAccessType" 
            (change)="onUserAccessValueChange($event)"
            formControlName="userAccessType"/>
            <kendo-label class="k-radio-label" for="internalUserAccessType" text="Internal" ></kendo-label>
          </span>
          <span class="app-radiobtnwidtext-wrapper">
            <input type="radio" [(ngModel)]="userAccessType"  id="externalUserAccessType" value="EXTERNAL" aria-labelledby="External" kendoRadioButton name="userAccessType" 
            (change)="onUserAccessValueChange($event)"
            formControlName="userAccessType"/>
            <kendo-label class="k-radio-label" for="externalUserAccessType" text="External" ></kendo-label>
          </span>          
        </div>
        <kendo-formerror *ngIf="userFormControls?.userAccessType.errors?.required
                              && userFormControls?.userAccessType.touched">
                              User Access Type is required.
        </kendo-formerror>
      </div>
      <div class="flex-col">
        <kendo-floatinglabel text="PNumber or ORNumber">
          <kendo-textbox [fillMode]="formUiStyle.inputFillMode"
          formControlName="pNumber"
          (valueChange)="onPNumberValueChange($event)"> </kendo-textbox>
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="userFormControls?.pNumber.errors?.required
                              && userFormControls?.pNumber.touched">
                              PNumber or ORNumber is required.
        </kendo-formerror>
        <kendo-formerror *ngIf="userFormControls?.pNumber.touched
                                && isPNumberValueChanging
                                && adUserPNumberData == null
                                && !isRequestingPNumber">
                              {{enteredPnumberValue}} not in ORCares Active Directory Group.
        </kendo-formerror>
        <kendo-formerror *ngIf="userFormControls?.pNumber.touched
                                && isPNumberValueChanging
                                && isPNumberAlreadyExists
                                && adUserPNumberData != null
                                && !isRequestingPNumber">
                              {{enteredPnumberValue}} already entered.
        </kendo-formerror>
      </div>
      <div class="flex-col">
        <kendo-floatinglabel text="First Name">
          <kendo-textbox [fillMode]="formUiStyle.inputFillMode" [disabled]="isAccessTypeInternal"
          name="firstName"
          formControlName="firstName"> </kendo-textbox>          
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="userFormControls?.firstName.errors?.required
                              && userFormControls?.firstName.touched">
                              First Name is required.
        </kendo-formerror>
      </div>
      <div class="flex-col">
        <kendo-floatinglabel text="Last Name">
          <kendo-textbox [fillMode]="formUiStyle.inputFillMode" [disabled]="isAccessTypeInternal"
          formControlName="lastName"
          name="lastName"> </kendo-textbox>          
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="userFormControls?.lastName.errors?.required
                              && userFormControls?.lastName.touched">
                              Last Name is required.
        </kendo-formerror>
      </div>

      <div class="flex-col">
        <kendo-floatinglabel text="Email Address">
          <kendo-textbox [fillMode]="formUiStyle.inputFillMode" [disabled]="isAccessTypeInternal"
          formControlName="email"
          name="email"> </kendo-textbox>          
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="userFormControls?.email.errors?.required
                              && userFormControls?.email.touched">
                              Email is required.
        </kendo-formerror>
        <kendo-formerror *ngIf="userFormGroup?.get('email')?.invalid && userFormGroup?.get('email')?.errors?.['pattern'] && (userFormGroup?.get('email')?.touched)">Incorrect Email Format.</kendo-formerror>
      </div>


      <div class="flex-col">
        <kendo-floatinglabel text="Role" class="inline-search-loader">
        <kendo-multiselect
        [readonly]="false"
        [fillMode]="formUiStyle.dropDownFillMode"
        [data]="ddlUserRole$ | async"
        aria-label="role"
        valueField="roleId" 
        textField="roleDesc"  
        formControlName="role"
        (valueChange)="onRoleValueChange($event)"
        ></kendo-multiselect>
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="userFormControls?.role.errors?.required
                                && userFormControls?.role.touched">
                              Role is required.
        </kendo-formerror>
      </div>

      <div class="flex-col" *ngIf="!isAccessTypeInternal">
        <kendo-floatinglabel text="Domain">
          <kendo-dropdownlist [fillMode]="formUiStyle.dropDownFillMode" [data]="caseManagerDomainLov$ | async"
            valueField="lovCode" textField="lovDesc"
            formControlName="domain"
            [(ngModel)]="selectedDomain"
            [valuePrimitive] = false
            > </kendo-dropdownlist>
            <kendo-formerror *ngIf="userFormControls?.domain.errors?.required
                                && userFormControls?.domain.touched">
                              Domain is required.
        </kendo-formerror>
        </kendo-floatinglabel>
      </div>
      <div class="flex-col" *ngIf="!isAccessTypeInternal">
        <kendo-floatinglabel text="Group">
          <kendo-dropdownlist [fillMode]="formUiStyle.dropDownFillMode" [data]="caseManagerAssistorGrp$ | async"
            valueField="lovCode" textField="lovDesc"
            formControlName="group"
            [(ngModel)]="selectedGroup"
            name="group"> </kendo-dropdownlist>
            <kendo-formerror *ngIf="userFormControls?.group.errors?.required
                                && userFormControls?.group.touched">
                              Group is required.
        </kendo-formerror>
        </kendo-floatinglabel>
      </div>
    </div>
  </form>
</section>

<kendo-dialog-actions>
  <div class="justify-content-between">
    <div *ngIf="isEditValue">
      <button [disabled]="status===deactivate" kendoButton [primary]="true" aria-label="Deactivate" look="flat"
        (click)="onDeactivateClicked()">Deactivate</button>
    </div>
    <div class="justify-content-end">
      <button kendoButton [primary]="true" aria-label="Cancel" look="outline">Cancel</button>
      <button kendoButton [primary]="true" attr.aria-label=" {{ isEditValue ? 'Update' : 'Add' }}"
      (click)="onUserSaveButtonClick()">
        {{ isEditValue ? 'Update' : 'Add' }}
      </button>
    </div>
  </div>
</kendo-dialog-actions>

<!-- Deactivate User Modal Html-->
<kendo-dialog *ngIf="isUserDeactivatePopup" (close)="onUserDeactivateClosed()"
  class="app-c-modal app-c-modal-sm app-c-modal-np">
  <kendo-dialog-titlebar> Deactivate user?</kendo-dialog-titlebar>
  <system-config-deactivate-user-confirmation 
    [userId]="userId" [status]="deactivate" (closeDeactivateUsers)="onUserDeactivateClosed()" (refreshGrid)="loadUserListGrid()" ></system-config-deactivate-user-confirmation>
</kendo-dialog>
