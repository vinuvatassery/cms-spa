<div class="app-c-fab-sidePanel sidePanel-event-log">
  <!-- Side Panel Header -->
  <div class="sidePanel_header">
    <div class="sidePanel_header-left">
      <h3>Event Log</h3>
      <button
        kendoButton
        class="k-icon-button small-i-btn"
        title="New event"
        aria-label="New event"
        (click)="onOpenEventDetailsClicked(eventDetailsDialogTemplate, false)"
      >
        <span
          class="material-icons"
          aria-label="add event log"
          aria-hidden="true"
          >add</span
        >
      </button>
    </div>
    <div class="sidePanel_header-right">
      <div class="input-search mat-form-no-b-space" *ngIf="isShownSearch">
          <kendo-textbox aria-label="search event"  placeholder="Search events"  [fillMode]="formUiStyle.inputFillMode"
          [(ngModel)]="searchText" (valueChange)="loadLogEvent()" (blur)="showHideSearch()">
           </kendo-textbox>
      </div>
      <button
        kendoButton
        class="k-icon-button small-i-btn"
        aria-label="Search"
        title="Search"
        (click)="onShowSearchClicked()"
        *ngIf="!isShownSearch"
      >
        <span
          class="material-icons"
          aria-label="Search"
          aria-hidden="true"
          >search</span
        >
      </button>
      <button #eventFilterCardBtn kendoButton (click)="isEventFilterPopoverOpen = !isEventFilterPopoverOpen">
        <span class="material-icons" aria-label="More option" *ngIf="!isEventFilterPopoverOpen"> more_vert </span>

        <span class="material-icons" aria-label="Cancel" *ngIf="isEventFilterPopoverOpen"> cancel </span>
      </button>
      <div class="event-filter_popover_wrapper" *ngIf="isEventFilterPopoverOpen" #eventtFilterPopover>
        <div class="event-filter-body">
          <div class="event-filters">
            <button kendoButton look="flat" aria-label="Sort Ascending" class="btn-h-primary" aria-hidden="false" (click)="sortByMethod('asc')" [selected]="sortType=='asc'">
              <span class="material-icons" aria-hidden="true" aria-label="Sort Ascending">arrow_upward</span>
              <label> Sort Ascending </label>
            </button>
            <button kendoButton look="flat" aria-label="Sort Descending" class="btn-h-primary" aria-hidden="false" (click)="sortByMethod('desc')" [selected]="sortType=='desc'">
              <span class="material-icons" aria-hidden="true" aria-label="Sort Descending">arrow_downward</span>
              <label> Sort Descending </label>
            </button>
            <button kendoButton look="flat" aria-label="Filter" class="btn-h-primary" aria-hidden="false"
              (click)="isShowFilter = !isShowFilter" [toggleable]="isShowFilter">
              <span class="material-icons" aria-hidden="true" aria-label="Filter">filter_list</span>
              <label> Filter </label>
            </button>
          </div>
          <div class="event-filters-field" *ngIf="isShowFilter" [formGroup]="eventLogFilterForm">
            <kendo-floatinglabel class="mb-1" text="Case Worker">
              <kendo-dropdownlist aria-label="Case Worker" [fillMode]="formUiStyle.dropDownFillMode" formControlName="caseworkerfilterbyoperator"
             [data]="operators" textField="text" valueField="value" [valuePrimitive]="true" placeholder="Case Worker">
              </kendo-dropdownlist>
              <kendo-textbox aria-label="Case Worker" [clearButton]="true" *ngIf="eventLogFilterForm.controls['caseworkerfilterbyoperator'].value.length > 0"
                formControlName="caseworkerfilterbyvalue" rounded="medium" [fillMode]="formUiStyle.inputFillMode"
                (valueChange)="onChange('CASEWORKER')">
              </kendo-textbox>
            </kendo-floatinglabel>
            <kendo-floatinglabel class="mb-1" text="Event Type">
              <kendo-dropdownlist aria-label="Event Type" [fillMode]="formUiStyle.dropDownFillMode" formControlName="eventtypefilterbyoperator"
              [data]="operators" textField="text" valueField="value" [valuePrimitive]="true" placeholder="Event Type">
              </kendo-dropdownlist>
              <kendo-textbox aria-label="Event Type" [clearButton]="true" *ngIf="eventLogFilterForm.controls['eventtypefilterbyoperator'].value.length > 0"
                formControlName="eventtypefilterbyvalue" rounded="medium" [fillMode]="formUiStyle.inputFillMode"
                (valueChange)="onChange('EVENTTYPE')">
              </kendo-textbox>
            </kendo-floatinglabel>
            <kendo-floatinglabel class="mb-1" text="After Date">
              <kendo-datepicker class="mb-1" [fillMode]="formUiStyle.dateInputFillMode" aria-label="After Date"
                format="MM/dd/yyyy" formatPlaceholder="formatPattern" formControlName="afterdatefilter" placeholder="After Date"
                (valueChange)="onChange('AFTERDATE')" [max]="eventLogFilterForm.controls['beforedatefilter'].value" [incompleteDateValidation]="true">
              </kendo-datepicker>
            </kendo-floatinglabel>
            <kendo-floatinglabel class="mb-1" text="Before Date">
              <kendo-datepicker class="mb-1" [fillMode]="formUiStyle.dateInputFillMode" aria-label="Before Date"
                format="MM/dd/yyyy" formatPlaceholder="formatPattern" formControlName="beforedatefilter" placeholder="Before Date"
                (valueChange)="onChange('BEFOREDATE')" [min]="eventLogFilterForm.controls['afterdatefilter'].value" [incompleteDateValidation]="true">
              </kendo-datepicker>
            </kendo-floatinglabel>
            <div class="d-flex event-filter-button">
              <button kendoButton [primary]="true" aria-label="Filter" (click)="onEventLogFilterFilterClicked()" [disabled]="!isEnableFilterBtn">
                FILTER
              </button>&nbsp;&nbsp;
              <button kendoButton [primary]="true" look="outline" aria-label="Clear" (click)="onEventLogFilterClearClicked()" [disabled]="!isEnableFilterBtn">
                CLEAR
              </button>
            </div>
          </div>
        </div>
      </div>

      <button kendoButton class="k-icon-button small-i-btn" aria-label="close" (click)="onCloseEventLogClicked()"
        title="close">
        <span class="material-icons" aria-label="close" aria-hidden="true">close</span>
      </button>
    </div>
  </div>

  <div class="sidePanel_body">
    <ul aria-label="event log menu" class="event-log-list">
      <!-- Event list items -->

      <li *ngFor="let eventLog of events; let i = index" aria-label="event log menu item" class="event-log-list_items">
        <section>
          <div class="items-head">
            <p class="items-head_label">{{eventLog.eventDesc}}</p>
            <p class="items-head_info text-right">
              {{eventLog.creationTime | date : 'MM/dd/yyyy'}} by

            <span class="items-head_info-user">

              <common-user-photo-icon
              [userId]="eventLog.creatorId"
              [userFirstName]="eventLog.createdBy"
              [userLastName]="''"
              [linkType]="'profileLink'"
              [position]="'left'"
              [callout]="false">
            </common-user-photo-icon>

            </span>
            </p>
          </div>
          <div class="items-body">
            <button
              kendoButton
              class="k-icon-button small-i-btn add-sub-button"
              title="New sub-event"
              (click)="onOpenEventDetailsClicked(eventDetailsDialogTemplate, true, eventLog.eventLogId, eventLog.eventId)"
              aria-label="New sub-event"
            >
              <span
                class="material-icons"
                aria-label="New sub-event"
                aria-hidden="true"
                >add</span
              >
            </button>
            <!-- <span class="items-body_details">{{eventLog.eventLogDesc}}</span> -->
            <div class="items-body">
              <common-read-more
              [content]="eventLog.eventLogDesc"
              [limit]="250"
              [completeWords]="true">

              </common-read-more>
            </div>
            <span *ngIf="eventLog.userEventFlag && eventLog.attachments?.length > 0"
              class="text-primary text-underline c-pointer"
              (click)="downloadAttachment(eventLog.attachments[0]?.eventLogAttachmentId, eventLog.attachments[0]?.attachmentFilePath)">
              View Attachment</span>
          </div>
        </section>

        <!-- Event sub list items -->
        <ul *ngFor="let subEventLog of eventLog.subEventLogs; let i = index" aria-label="event log menu" class="event-log-list">
          <!-- Event list items -->
          <li aria-label="event log menu item" class="event-log-list_items">
            <section>
              <div class="items-head">
                <p class="items-head_label">{{subEventLog.eventDesc}}</p>
                <p class="items-head_info text-right">
                  {{subEventLog.creationTime | date: 'MM/dd/yyyy'}} by
                  <span class="items-head_info-user">

                    <common-user-photo-icon
                    [userId]="subEventLog.creatorId"
                    [userFirstName]="subEventLog.createdBy"
                    [userLastName]="''"
                    [linkType]="'profileLink'"
                    [position]="'left'"
                    [callout]="false">
                  </common-user-photo-icon>

                  </span>
                </p>
              </div>
              <div class="items-body">
                <common-read-more
                [content]="subEventLog.eventLogDesc"
                [limit]="250"
                [completeWords]="true">
                </common-read-more>

                <span *ngIf="subEventLog.userEventFlag && subEventLog.attachments?.length > 0"
                  class="text-primary text-underline c-pointer"
                  (click)="downloadAttachment(subEventLog.attachments[0]?.eventLogAttachmentId, subEventLog.attachments[0]?.attachmentFilePath)">
                  View Attachment</span>
              </div>
            </section>
          </li>
        </ul>
        <!-- Event sub list items -->
      </li>
    </ul>

    <div *ngIf="events.length <= 0" class="mt-1" >    
      <div *ngFor="let skeletonCount of skeletonCounts" class="event_log_loader">
        <kendo-skeleton  shape="rectangle"   animation="pulse"   class="event_bgloader" ></kendo-skeleton>
      <div class="event_log_loader_first">
        <kendo-skeleton shape="text"  animation="pulse"   width="20%"   ></kendo-skeleton>
        <kendo-skeleton   shape="text"    animation="pulse"   width="40%" ></kendo-skeleton>
      </div>

      <div class="event_log_loader_second">
        <kendo-skeleton shape="text" animation="pulse" width="100%"></kendo-skeleton> 
        <kendo-skeleton shape="text" animation="pulse" width="100%"></kendo-skeleton> 
        <kendo-skeleton shape="text" animation="pulse"  width="50%" ></kendo-skeleton>
      </div>
      </div>
      <!-- <kendo-skeleton   shape="rectangle" animation="pulse" width="100%" height="50px" style="margin-bottom: 4px;">
      </kendo-skeleton> -->
      </div>
    <!-- <div *ngIf="events.length <= 0">
      <kendo-skeleton  *ngFor="let skeletonCount of skeletonCounts" shape="rectangle" animation="pulse"
      class="event-list-skeleton-loader"></kendo-skeleton>
    </div> -->
    <div class="filter-footer-event" *ngIf="filterBy.length > 0">
      <small>Filtered By: {{filterBy}} <a (click)="onEventLogFilterClearClicked()">Clear</a></small>
    </div>
  </div>
</div>
<!-- Add Event Modal Html-->
<ng-template #eventDetailsDialogTemplate>

  <kendo-dialog-titlebar  (close)="onCloseEventDetailsClicked(false)"> {{isSubEvent?  'Add Sub-Event' : 'Add Event'  }}</kendo-dialog-titlebar>
  <productivity-tools-event-detail  [isSubEvent]="isSubEvent" [parentEventLogId]="parentEventLogId"  [eventList]="isSubEvent ? SubEventList : eventList"  [entityId] = "entityId" [clientCaseEligibilityId]="clientCaseEligibilityId" [entityType] = "entityType"  [eventAttachmentTypeList]="eventAttachmentTypeList" [eventsdata$]="eventsdata$"  (closeEventDetailsClickedEmitter)="onCloseEventDetailsClicked($event)"></productivity-tools-event-detail>
</ng-template>
