<span class="header-menu_notifications ml-1 mr-1" >
  <button
    kendoButton
    #anchor
    (click)="onNotificationButtonToggleClicked()"
    look="flat"
    class="header-buttons user-button" 
    title="Notifications"
  >
    <span class="material-icons" aria-hidden="true" aria-label="Notifications"
      >notifications</span
    >
    <span class="notification-badge">{{unViewedCount ? unViewedCount : 0}}</span>
    <common-signalr-status></common-signalr-status>
  </button>
  <kendo-popup
    #popup
    [anchor]="$any(anchor)"
    popupClass="content"
    *ngIf="isNotificationPopupOpened"
    popupClass="notification-inner"
  >
    <div class="app-c-card">
      <!-- If no notifications -->
      <div class="no-notification-container" hidden>
        <span
          class="material-icons"
          aria-label="no notifications"
          aria-hidden="true"
          >notifications_off</span
        >
        <p>No Notifications</p>
      </div>

      <!-- Notification List -->
      <ul class="card-list pt-0" aria-label="notification menu" *ngIf = "!itemsLoader">
        <!-- List Item Repeatable -->
        <li
          class="card-list_items"
          *ngFor="let message of alertsData?.items"
          [ngClass]="message.recentViewedFlag === 'N'  ? 'card-list_items unread-item' : 'inherit'"
       
          aria-label="notification menu item"
        >
          <div class="card-type-icon">
            <span *ngIf="message.alertTypeCode === 'NOTIFICATION'"
              class="material-icons"
              aria-label="notifications"
              aria-hidden="true"
              >notifications</span>

              <span *ngIf="message.alertTypeCode === 'REMINDER'"
              class="material-icons"
              aria-label="alarm"
              aria-hidden="true"
              >alarm</span>
          </div>
          <div class="card-list_details">
            <div class="card-list_details">
              <div *ngIf="message.alertDesc.length > 70" class="description-banner">
                <p *ngIf="!message.showFullDescription">{{ message.alertDesc.substring(0, 70) }}...</p>
                <p *ngIf="message.showFullDescription">{{ message.alertDesc }}</p>
                <a (click)="toggleDescription(message)">
                  {{ message.showFullDescription ? 'See Less' : 'See More' }}
                </a>
              </div>
              <div *ngIf="message.alertDesc.length <= 70">
                <p [innerHTML]="sanitizeHtml(message.alertDesc)"></p>
              </div>
            <p class="text-muted">{{message?.alertDueDate | date:'MM/dd/YYYY'}}  {{ formatTime(message?.repeatTime) }}</p>
          </div>
          </div>
          <kendo-dropdownbutton
            [data]="dataTwo"
            *ngIf="message.alertTypeCode == 'REMINDER'"
            title="More option"
            look="bare"
            aria-label="more actions"
            class="small-i-btn app-dropdown-action more_action_wid"
            [popupSettings]="{ popupClass: popupClass1, animate: true }"
            (itemClick)="onActionClicked($event,message)"
          >
          <span 
           class="material-icons" aria-label="More option"> more_vert    </span>
          <ng-template class="app-dropdown-action-list"
           kendoDropDownButtonItemTemplate let-dataItem>
            <button kendoButton  look="flat" [attr.aria-label]="dataItem.text" [class]="dataItem.buttonType" aria-hidden="false" (click)="dataItem.click">
              <span class="material-icons" aria-hidden="true" [attr.aria-label]="dataItem.text" >{{dataItem.icon}}</span>
              <label>   {{ dataItem.text }} </label>
          </button>          
            </ng-template>
          </kendo-dropdownbutton>
        </li>
      </ul>
      <div class="text-center mt-1 mb-1 p-2" *ngIf="alertsData?.items?.length === 0 && !itemsLoader">
            <common-grid-no-records></common-grid-no-records>
      </div>
      <div *ngIf="itemsLoader" class="p-2">    
        <div *ngFor="let skeletonCount of skeletonCounts" style="display: flex;margin-bottom: 6px;">
          <kendo-skeleton
          shape="rectangle"
          animation="pulse"
          [width]="40"
          [height]="40"
        ></kendo-skeleton>
        <div [ngStyle]="{ flex: '1 1 50%', marginLeft: '16px' }">
          <kendo-skeleton
            shape="text"
            animation="pulse"
            width="100%"
          ></kendo-skeleton>
          <kendo-skeleton
            shape="text"
            animation="pulse"
            width="40%"
          ></kendo-skeleton>
        </div>
        </div>
 
        </div>
      <!-- Notification Footer Buttons -->
      <div class="notification-footer">
        <button
          kendoButton
          class="text-t-normal text-bold"
          look="flat"
          (click)="onNotificationsAndRemindersOpenClicked(notificationsAndRemindersDialog)"
          aria-label="view all notifications"
        >
          View All Notifications
        </button>
        <button
          kendoButton
          look="flat"
          icon=""
          (click)="onNewReminderOpenClicked(NewReminderTemplate)"
          aria-label="add reminder"
          title="Add Reminder"
        >
          <span
            class="material-icons"
            aria-label="add reminder"
            aria-hidden="true"
            >add_alarm</span
          >
        </button>
      </div>
    </div>
  </kendo-popup>
</span>

<!-- Create New Reminder Popup -->
<ng-template #NewReminderTemplate>
  <kendo-dialog-titlebar (close)="onNewReminderClosed(false)">
    {{crudText}} Reminder{{isDelete === true ? '?' : ''}}</kendo-dialog-titlebar>
  <productivity-tools-reminder-detail
  [isEdit]="isEdit" 
  [isDelete]="isDelete"
  [alertId] = "selectedAlertId"
  (onGetTodoItem)="onGetTodoItemData($event)"
  [getTodo$]="getTodo$"
  [isFromNotificationPanel]="true"
  [searchProviderSubject]="searchProviderSubject"
   [entityTypeCodeSubject$]="entityTypeCodeSubject$"
    (isModalNewReminderCloseClicked)="onNewReminderClosed($event)"
    [medicalProviderSearchLoaderVisibility$]="medicalProviderSearchLoaderVisibility$"
    [providerSearchResult$]="  providerSearchResult$"
    [clientSubject]="clientSubject"
    [clientSearchResult$]="clientSearchResult$"
    [clientSearchLoaderVisibility$]="clientSearchLoaderVisibility$"
    (searchClientName)="searchClientName($event)"
    (searchProvider)="searchProvider($event)"
    (remainderFor)="remainderFor($event)"
    (getReminderDetailsLov)="getReminderDetailsLov()"
    ></productivity-tools-reminder-detail>
</ng-template>

<ng-template #deleteReminderTemplate> 
  <productivity-tools-delete-reminder-confirmation
    (isModalDeleteReminderCloseClicked)="onDeleteReminderClosed($event)"></productivity-tools-delete-reminder-confirmation>
</ng-template>


<!-- Create New Reminder Popup -->
<ng-template #notificationsAndRemindersDialog>
 
  <kendo-dialog-titlebar  (close)="onNotificationsAndRemindersClosed()">
    <span
      class="material-icons mr-1"
      aria-hidden="true"
      aria-label="notifications"
      >notifications</span
    >
    <span class="text-bold">Notifications and Reminders</span>
  </kendo-dialog-titlebar>

 <productivity-tools-notification-and-reminder-page [focusedTab]="notificationAndReminderPageTab"  (closeDialog)="onCloseNotificationsAndReminders($event)"></productivity-tools-notification-and-reminder-page>
</ng-template>
