<kendo-dialog-titlebar (close)="closeAddEditRefundFormModalClicked()">
    <section class="app-l-mainTittle">
        <h1 class="maintitle_withicon text-bold">{{isEdit?"Edit": "Add New"}} Refund {{selectedRefundType}}</h1>
    </section>
</kendo-dialog-titlebar>
<section class="k-dialog-body">
    <section class="add_main_popup_screen">
        <div class="add_new_top_section">
            <p class="mb-3"> Search for a client to add insurance, provider, prescription, or tax refunds.</p>
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <div class="combotable_search_list new_refund_Search">
                        <span class="material-icons global-search-icon" aria-label="search"
                            aria-hidden="true">search</span>
                        <span *ngIf="isShownSearchLoader"
                            class=" k-icon k-i-loading k-input-loading-icon input-inline-loader"></span>
                        <kendo-multicolumncombobox [data]="clientSearchResult$ | async" textField='clientNames'
                        valueField="clientId" [fillMode]="formUiStyle.dropDownFillMode"
                        placeholder="Search Client Name, ID, SSN or DOB"
                        [popupSettings]="{popupClass: 'combotable_search_list', animate: true }"
                        [filterable]="true"
                        (filterChange)="loadClientBySearchText($event)"
                        (valueChange)="onClientValueChange($event)" [(ngModel)]="selectedClient"
                        [disabled]="disableFeildsOnConfirmSelection" >
                            <button kendoButton fillMode="clear" icon="image"></button>

                            <kendo-combobox-column>
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span>{{ dataItem.clientFullName }}</span>
                                </ng-template>
                            </kendo-combobox-column>
                            <kendo-combobox-column [width]="100">
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class=" text-muted"> <em>ID:</em> {{dataItem.clientId}}</span>
                                </ng-template>
                            </kendo-combobox-column>
                            <kendo-combobox-column [width]="150">
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class="text-muted"><em> SSN:</em> {{ dataItem.ssn }}</span>
                                </ng-template>
                            </kendo-combobox-column>
                            <kendo-combobox-column [width]="125">
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class=" text-muted"> <em>DOB:</em> {{ dataItem.dob}}</span>
                                </ng-template>
                            </kendo-combobox-column>                          
                        </kendo-multicolumncombobox>
                    </div>

                </div>
            </div>
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <kendo-floatinglabel text="Refund Type">
                        <kendo-dropdownlist [disabled]="disableFeildsOnConfirmSelection" aria-label="Refund Type" [(ngModel)]="selectedRefundType"
                            [data]="refundType" 
                            textField="lovDesc" valueField="lovCode" [valuePrimitive]="true"
                            [fillMode]="formUiStyle.dropDownFillMode"  (selectionChange)="selectionChange($event)">
                        </kendo-dropdownlist>
                    </kendo-floatinglabel>
                </div>
            </div>
            <div class="flex-row" *ngIf="selectedRefundType === 'INSURANCE_PREMIUM'||selectedRefundType === 'TPA'">
                <div class="flex-col flex-col-6">
                    <kendo-floatinglabel  text="Vendor">
                        <div class="combotable_search_list new_refund_Search">                           
                                  <span *ngIf="isShownSearchLoader"
                                      class=" k-icon k-i-loading k-input-loading-icon input-inline-loader"></span>
                                      <kendo-multicolumncombobox [data]="vendors$ | async" 
                                      textField='providerFullName'
                                      valueField="vendorId" [fillMode]="formUiStyle.dropDownFillMode"
                                      placeholder="Search Vendor Name, ID"
                                      [popupSettings]="{popupClass: 'combotable_search_list', animate: true }"
                                      [filterable]="true" 
                                      (filterChange)="searchVendors($event)"
                                      (valueChange)="onProviderValueChange($event)" data [(ngModel)]="selectedProvider"
                                      >
                                    
                                      <button kendoButton fillMode="clear" icon="image"></button>
          
                                      <kendo-combobox-column>
                                          <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                              <span>{{ dataItem.vendorName }}</span>
                                          </ng-template>
                                      </kendo-combobox-column>
                                      <kendo-combobox-column [width]="100">
                                          <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                              <span class=" text-muted"> <em></em> {{dataItem.insuranceType}}</span>
                                          </ng-template>
                                      </kendo-combobox-column>
                                      <kendo-combobox-column [width]="150">
                                          <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                              <span class="text-muted"><em> </em> {{ dataItem.insuranceName }}</span>
                                          </ng-template>
                                      </kendo-combobox-column>
                                      <kendo-combobox-column [width]="125">
                                          <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                              <span class=" text-muted"> <em>Coverage effective dates:</em> {{ dataItem.coverageStartDate|date:'MM/dd/YYYY'}} - {{ dataItem.coverageEndDate|date:'MM/dd/YYYY'}}</span>
                                          </ng-template>
                                      </kendo-combobox-column>
                                      <ng-template kendoMultiColumnComboBoxNoDataTemplate>
                                          <div class="no-data-text">No vendors found</div>
                                      </ng-template>
                                  </kendo-multicolumncombobox>
                              </div>
                      </kendo-floatinglabel> 
                </div>

            </div>
            <div class="flex-row" *ngIf="selectedRefundType === 'PHARMACY'">
                <div class="flex-col flex-col-6">
                    <kendo-floatinglabel  text="Pharmacy Provider ">
                    <div class="combotable_search_list new_refund_Search">
                        <span class="material-icons global-search-icon" aria-label="search"
                            aria-hidden="true">search</span>
                        <span></span>
                    <kendo-multicolumncombobox textField="providerFullName" valueField="vendorId"
                    [fillMode]="formUiStyle.dropDownFillMode"
                    placeholder="Search pharmacy"
                    [popupSettings]="{popupClass: 'combotable_search_list', animate: true }"
                    [filterable]="true" 
                    (filterChange)="searchPharmacy($event)" [data]="pharmacySearchResult$ | async"
                    [(ngModel)]="selectedMedicalProvider" (valueChange)="onProviderValueChange($event)"
                    >
                        <kendo-combobox-column>
                            <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                <span>{{ dataItem.vendorName }}</span>
                            </ng-template>
                        </kendo-combobox-column>
                        <kendo-combobox-column>
                            <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                <span class="text-muted"><em> TIN:</em> {{ dataItem.tin | tin }}</span>
                            </ng-template>
                        </kendo-combobox-column>
 
                        <kendo-combobox-column>
                            <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                <span class="text-muted"><em> Mail Code:</em> {{ dataItem.mailCode }}</span>
                            </ng-template>
                        </kendo-combobox-column>
                      </kendo-multicolumncombobox>
                   </div>
                </kendo-floatinglabel>
                </div>

            </div>
        </div>

        <!-- TPA Content -->
        <div class="add_new_bottom_section" *ngIf="selectedRefundType==='TPA'&& vendorId && clientId">
            <!-- TPA Claims Grid -->
            <div class="mt-1" >
                <h5>Select claims to refund</h5>
                <div class="add_new_fixed_bottom_grid_section">
                        <cms-vendor-refund-claims-list  #tpaClaims  [tpaPaymentReqIds]="tpaPaymentReqIds"
                    [vendorId]="vendorId" [clientId]="clientId"  [pageSizes]="pageSizes"
                    [sortValue]="sortValueClientClaims" [sortType]="sortType"
                    (claimsCount)="claimsCountEvent($event)"  ></cms-vendor-refund-claims-list>
                </div>
            </div>
            <div class="confirm-container" *ngIf="isConfirmationClicked"> 
            <!-- TPA Claims Refund Form -->
            <div class="flex-row" >
                <div class="flex-col-6 flex-col">
                    <div class="flex-row">
                        <div class="flex-col mt-2 mb-2 "> 
                            <div class="text-center">
                                <a kendoButton look="flat" class="card-link-button" href="#medicalProviderPaymentslist">
                                    View Medical Provider Payments
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="flex-row align-items-center justify-content-between ">
                        <div class="flex-col flex-col-2">
                            <h5>Refund 1</h5>
                        </div>
                        <div class="flex-col flex-col-6">
                            <span class="app-checkboxwidtext-wrapper">
                                <input kendoCheckBox type="checkbox" id="spots-payment" name="spots-payment"
                                    aria-labelledby="spots-payment" />
                                <label class="k-checkbox-label" for="spots-payment">This is a SPOTS payment</label>
                            </span>
                        </div>
                        <div class="flex-col flex-col-4 justify-content-end">
                            <button class="" kendoButton fillMode="flat" aria-label="Delete"
                                themeColor="error">DELETE</button>
                        </div>

                    </div>
                    <div class="flex-row">
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="Service Start Date">
                                <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode"
                                    aria-label="Service Start Date" format="MM/DD/YYYY"
                                    formatPlaceholder="formatPattern" placeholder="">
                                </kendo-datepicker>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="Service Start Date">
                                <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode"
                                    aria-label="Service Start Date" format="MM/DD/YYYY"
                                    formatPlaceholder="formatPattern" placeholder="">
                                </kendo-datepicker>
                            </kendo-floatinglabel>
                        </div>
                    </div>
                </div>

            </div>
            <!-- TPA Claims Info -->
            <div class="flex-row mt-1">
                <div class="flex-col flex-col-6">
                    <table class=" info-table-custom left_right_align mb-3">
                        <caption hidden> Refund Information</caption>
                        <tr hidden>
                            <th scope="col">Fields</th>
                            <th scope="col">Details</th>

                        </tr>
                        <tbody>
                            <tr>
                                <td>Invoice ID</td>
                                <td>XXXXXXXXXX</td>
                            </tr>
                            <tr>
                                <td>Original Warrant #</td>
                                <td>XXXXXXXXXX</td>
                            </tr>
                            <tr>
                                <td>PCA Code</td>
                                <td>XXXXXXXXXX</td>
                            </tr>
                            <tr>
                                <td>Grant #</td>
                                <td>XXXXXXXXXX</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
            <!-- TPA Claims CPT Grid -->
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <div class="app-c-table">
                        <kendo-grid [resizable]="true" [groupable]="false" [reorderable]="true" [resizable]="true"
                        [columnMenu]="false">
                        <kendo-grid-column field="CPTCode" title="CPT Code" [width]="200">
                            <ng-template kendoGridFooterTemplate let-column let-columnIndex="columnIndex">
                                Total
                            </ng-template>
                        </kendo-grid-column> 
                        <kendo-grid-column field="amountPaid" title="Original Amount Paid" [width]="180">
                            <ng-template kendoGridFooterTemplate let-column let-columnIndex="columnIndex">
                                <span class="tableamountview"> <strong>$</strong> XXXX.XX </span>
                            </ng-template>
                        </kendo-grid-column>  
                        <ng-template kendoGridLoadingTemplate>
                          <common-grid-loader-component></common-grid-loader-component>
                        </ng-template>
                        <!-- grid No data Template -->
                        <ng-template kendoGridNoRecordsTemplate>
                          <div> <kendo-badge-container> <span class="material-icons"> info </span> </kendo-badge-container>
                          </div>
                          <p>There is no data to display.</p>
                        </ng-template>
                      </kendo-grid>
                          </div>
                </div>
            </div>
            <!-- TPA Claims VP Form -->
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <div class="flex-row">
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text=" VP">
                                <kendo-textbox aria-label="VP" [disabled]="true" [fillMode]="formUiStyle.inputFillMode">
                                </kendo-textbox>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="VP Suffix (optional)">
                                <kendo-textbox aria-label="VP Suffix (optional)" [disabled]="true"
                                    [fillMode]="formUiStyle.inputFillMode">
                                </kendo-textbox>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="Refund Warrant #">
                                <kendo-textbox aria-label="Refund Warrant #" [fillMode]="formUiStyle.inputFillMode">
                                </kendo-textbox>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="Refund Amount" class="amount-with-symbol">
                                <span class="k-input-prefix custom-currencysymbol"> $ </span>
                                <kendo-numerictextbox aria-label="Refund Amount" [spinners]="false"
                                    [fillMode]="formUiStyle.inputFillMode" format="#.00">
                                </kendo-numerictextbox>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="Deposit Date">
                                <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode" aria-label="Deposit Date"
                                    format="MM/DD/YYYY" formatPlaceholder="formatPattern">
                                </kendo-datepicker>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-6">
                            <kendo-floatinglabel text="Refund Note (optional)">
                                <kendo-textbox aria-label="Refund Note (optional)"
                                    [fillMode]="formUiStyle.inputFillMode">
                                </kendo-textbox>
                                <kendo-formhint class="justify-content-end"><span class="counter">
                                        0/100</span></kendo-formhint>
                            </kendo-floatinglabel>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-3" id="medicalProviderPaymentslist">
                <h5>MEDICAL PROVIDER PAYMENT FOR FNAME LNAME</h5>
                <div class="add_new_fixed_bottom_grid_section">
                    <cms-vendor-refund-claims-list [claimsListData$]="claimsListData$" [pageSizes]="pageSizes"
                        [sortValue]="sortValueClaims" [sortType]="sortType" [sort]="sortClaims"
                        (loadClaimsListEvent)="loadClaimsListGrid($event)"
                        ></cms-vendor-refund-claims-list>
                </div>
            </div>
            </div>
        </div>

        <!-- INS Content -->
        <div class="add_new_bottom_section" *ngIf="selectedRefundType === 'INSURANCE_PREMIUM'&&vendorId&& clientId">
            <div class="mt-1" *ngIf="!isConfirmationClicked" >
                <h5>Select all premium included in this refund</h5>
                <div class="add_new_fixed_bottom_grid_section">
                    <cms-vendor-refund-insurance-premium-list  #insClaims  [selectedInsurancePremiumIds]="insurancePremiumPaymentReqIds"
                    [vendorId]="vendorId" [clientId]="clientId"  [pageSizes]="pageSizes"
                        [sortValue]="sortValueClientClaims" [sortType]="sortType"
                        [isEdit]="isEdit" [editPaymentRequestId]="inspaymentRequestId" (claimsCount)="claimsCountEvent($event)"
                        ></cms-vendor-refund-insurance-premium-list>
                </div>
            </div>
            <div class="confirm-container" *ngIf="isConfirmationClicked"> 

            <cms-vendor-refund-selected-premium-list [insuranceRefundInformation$]="insuranceRefundInformation$"
             [gridDataResult]="financialPremiumsRefundGridLists"
                     [refundInformationLoader$]="insuranceRefundInformationLoader$"
                     [pageSizes]="pageSizes" [sortValue]="sortValueRefundInformationGrid"
                     (onProviderNameClickEvent)="onInsurancePremiumProviderCick($event)"
            [sortType]="sortType" [sort]="sortRefundInformationGrid" (insuranceRefundInformationConfirmClicked)="getInsuranceRefundInformation($event)"
            [insuraceAddRefundClick$]="insuraceAddRefundClick$"
            (Reqpayload)="addInsuranceRefundClaim($event)"
            [vendorId]="vendorId"
            [clientId]="clientId"></cms-vendor-refund-selected-premium-list>
            
            </div>
        </div>

        <!-- RX Content -->
        <div class="add_new_bottom_section" *ngIf="selectedRefundType === 'PHARMACY' && vendorId && clientId"> 
            <div class="mt-1" *ngIf="!isConfirmationClicked">
                <h5>Select all claims included in this refund</h5>
                <div class="add_new_fixed_bottom_grid_section">
                    <cms-vendor-refund-client-claims-list #rxClaims  [selectedpharmacyClaimsPaymentReqIds]="pharmacyClaimsPaymentReqIds" [vendorId]="vendorId" [clientId]="clientId" 
                     [refundType]="selectedRefundType" [pageSizes]="pageSizes"
                        [sortValue]="sortValueClientClaims" [sortType]="sortType" [sort]="sortClientClaims"
                        (loadClientClaimsListEvent)="loadClientClaimsListGrid($event)" (claimsCount)="claimsCountEvent($event)"
                        (selectedVendorRefundsListEvent)="getSelectedVendorRefundsList($event)"
                        [confirmClicked]="inputConfirmationClicked"></cms-vendor-refund-client-claims-list>
                </div>
            </div>
            <div class="confirm-container" *ngIf="isConfirmationClicked"> 
            <div class="flex-row">
                <div class="flex-col flex-col-6 mt-2 mb-2 "> 
                    <div class="text-center">
                        <a kendoButton look="flat" class="card-link-button" href="#PharmacyPaymentsList">
                            View Pharmacy Payments
                        </a>
                    </div>
                </div>
            </div>

            <div class="flex-row">
                <div class="flex-col flex-col-2 align-items-center justify-content-start">
                    <h5>Refund Information </h5>
                </div>
                <div class="flex-col flex-col-4 align-items-center justify-content-start">
                    <span class="app-checkboxwidtext-wrapper">
                        <input kendoCheckBox type="checkbox" id="spots-payment" name="spots-payment"
                            aria-labelledby="spots-payment" 
                            id="isSpotsPaymentInputRX" [checked]="isSpotsPayment"
                            (change)="onSpotsPaymentChange($event)"
                            for="isSpotsPaymentInputRX"/>
                        <label class="k-checkbox-label" for="spots-payment">This is a SPOTS payment</label>
                    </span>
                </div>
            </div>
            <div *ngFor="let item of selectedVendorRefundsList; index as tblIndex">
                <div class="flex-row mb-3">
                <div class="flex-col flex-col-6">
                    <table class=" info-table-custom left_right_align ">
                        <caption hidden> Refund Information</caption>
                        <tr hidden>
                            <th scope="col">Fields</th>
                            <th scope="col">Details</th>
                        </tr>
                        <tbody>
                            <tr>
                                <td>Index Code</td>
                                <td>{{item.indexCode }}</td>
                            </tr>
                            <tr>
                                <td>PCA Code</td>
                                <td>{{item.pcaCode }}</td>
                            </tr>
                            <tr>
                                <td>Grant #</td>
                                <td>{{item.grantNo }}</td>
                            </tr>
                            <tr>
                                <td>Original Warrant #</td>
                                <td>{{item.warrantNbr }}</td>
                            </tr>
                            <tr>
                                <td>Original Payment Method</td>
                                <td>{{item.paymentStatusCode}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="flex-row mb-3">
                <div class="flex-col">
                    <h5>Enter quantity, days supply, and amount refunded</h5>
                    <div class="app-c-table">
                        <kendo-grid [resizable]="true" [groupable]="false" [reorderable]="true" [resizable]="true"
                            [columnMenu]="{ filter: true }"
                            [data] = item.prescriptionsDetail>
                            <kendo-grid-column field="rxNbr" title="RX #" [width]="160">
                                <ng-template kendoGridFooterTemplate let-column let-columnIndex="columnIndex">
                                    Total
                                </ng-template>
                            </kendo-grid-column>
                            <kendo-grid-column field="warrantNbr" title="NDC Code" [width]="160">
                            </kendo-grid-column>
                            <kendo-grid-column field="brandName" title="Brand Name" [width]="180">
                            </kendo-grid-column>
                            <kendo-grid-column field="drugName" title="Drug Name" [width]="140"> </kendo-grid-column>
                            <kendo-grid-column field="prescriptionFillDate" title="Fill Date" [width]="130"> </kendo-grid-column>
                            <kendo-grid-column field="amountPaid" title="Original Amount Paid" [width]="180">
                                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex" format="{0:c2}">
                                    <label aria-label="Original Amount Paid" kendoButton look="flat"
                                        class="card-link-button">
                                        <strong>$</strong> {{dataItem?.amountPaid}}
                                    </label>
                                </ng-template>
                                <ng-template kendoGridFooterTemplate let-column let-columnIndex="columnIndex">
                                    <span class="tableamountview"> <strong>$</strong> {{getSumOfColumn(item.prescriptionsDetail,'amountPaid')}} </span>
                                </ng-template>
                            </kendo-grid-column>
                            <kendo-grid-column field="rxqty" title="RX Qty." [width]="120" > </kendo-grid-column>
                            <kendo-grid-column field="daySupply" title="RX Days Supply" [width]="150">
                            </kendo-grid-column>
                            <kendo-grid-column field="pmtStatus" title="Payment Type" [width]="130">
                            </kendo-grid-column>
                            <kendo-grid-column field="by" title="By" [width]="75" class="text-center">
                                <ng-template kendoGridCellTemplate let-dataItem>
                                    <button kendoButton [primary]="true" class="avatar-sm-btn c-default"
                                        kendoPopoverAnchor [popover]="onUserProfileDetailsHovered" showOn="hover"
                                        [attr.aria-label]="dataItem.creatorId">
                                        <common-user-photo-icon [userId]="dataItem.creatorId"></common-user-photo-icon>
                                    </button>
                                    <kendo-popover #onUserProfileDetailsHovered width="330" position="left">
                                        <ng-template kendoPopoverBodyTemplate>
                                            <common-user-profile-card
                                                [userId]="dataItem.by"></common-user-profile-card>
                                        </ng-template>
                                    </kendo-popover>
                                </ng-template>
                            </kendo-grid-column>
                            <kendo-grid-column editor="numeric" format="n" [width]="100" field="qtyRefunded" title="Qty Refunded" [editable]="true" [sticky]="true" [width]="130">
                                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">              
                                    <kendo-numerictextbox  
                                    id ="qtyRefunded{{tblIndex}}-{{rowIndex}}"  
                                    name ="qtyRefunded{{tblIndex}}-{{rowIndex}}"
                                    [fillMode]= "formUiStyle.inputFillMode"
                                    aria-label="Qty Refunded"
                                    placeholder="Qty Refunded"
                                    [min] = "0"
                                    [(ngModel)]="dataItem.qtyRefunded"
                                    [ngClass]="ngDirtyInValid(dataItem,'qtyRefunded',tblIndex,rowIndex)"
                                    >                                          
                                  </kendo-numerictextbox>
                                  <kendo-formerror *ngIf="!dataItem.qtyRefundedValid">Qty Refunded is required</kendo-formerror>
                              </ng-template>    
                            </kendo-grid-column>
                            <kendo-grid-column field="daySupplyRefunded" title="Days Supply Refunded" [width]="160"
                                [sticky]="true">
                                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">              
                                    <kendo-numerictextbox  
                                    id ="daySupplyRefunded{{tblIndex}}-{{rowIndex}}"  
                                    name ="daySupplyRefunded{{tblIndex}}-{{rowIndex}}"
                                    [fillMode]= "formUiStyle.inputFillMode"
                                    aria-label="Days Supply Refunded"
                                    placeholder="Days Supply Refunded"
                                    [(ngModel)]="dataItem.daySupplyRefunded"
                                    [min] = "0"
                                    [ngClass]="ngDirtyInValid(dataItem,'daySupplyRefunded',tblIndex,rowIndex)"
                                    >                                          
                                  </kendo-numerictextbox>
                                  <kendo-formerror *ngIf="!dataItem.daySupplyRefundedValid">Days Supply Refunded is required</kendo-formerror>
                                </ng-template>
                                </kendo-grid-column>
                            <kendo-grid-column field="pmtStatus" title="Refund Amount" [width]="150" [sticky]="true">
                                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">              
                                    <kendo-numerictextbox  
                                    id ="refundedAmount{{tblIndex}}-{{rowIndex}}"  
                                    name ="refundedAmount{{tblIndex}}-{{rowIndex}}"
                                    [fillMode]= "formUiStyle.inputFillMode"
                                    aria-label="Refund Amount"
                                    placeholder="Refund Amount"
                                    [min] = "0"
                                    [(ngModel)]="dataItem.refundedAmount"
                                    [ngClass]="ngDirtyInValid(dataItem,'refundedAmount',tblIndex,rowIndex)"
                                    >                                          
                                  </kendo-numerictextbox>
                                  <kendo-formerror *ngIf="!dataItem.refundedAmountValid">Refund Amount is required</kendo-formerror>
                                </ng-template>
                                <ng-template kendoGridFooterTemplate let-column let-columnIndex="columnIndex">
                                    <span class="tableamountview"> <strong>$</strong> {{getSumOfColumn(item.prescriptionsDetail, 'refundedAmount')}} </span>
                                </ng-template>
                            </kendo-grid-column>
                            <ng-template kendoGridLoadingTemplate>
                                <common-grid-loader-component></common-grid-loader-component>
                            </ng-template>
                            <!-- grid No data Template -->
                            <ng-template kendoGridNoRecordsTemplate>
                                <div> <kendo-badge-container> <span class="material-icons"> info </span>
                                    </kendo-badge-container>
                                </div>
                                <p>There is no data to display.</p>
                            </ng-template>
                        </kendo-grid>
                    </div>
                </div>
            </div>
            </div>
            <div class="flex-row mb-3">
                <div class="flex-col" [formGroup]="refundRXForm">
                    <div class="flex-row">
                        <div class="flex-col flex-col-3">
                            <kendo-floatinglabel text="Voucher Payable" >
                                <kendo-textbox aria-label="Voucher Payable"  [fillMode]="formUiStyle.inputFillMode"
                                formControlName = "voucherPayable"
                                [maxlength]="7">
                                </kendo-textbox >
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-3">
                            <kendo-floatinglabel text="Credit #">
                                <kendo-textbox  aria-label="Credit # (optional)" 
                                    formControlName= "creditNumber"
                                    [fillMode]="formUiStyle.inputFillMode"  name="creditNumber"
                                    placeholder="Credit #"
                                    [maxlength]="6">
                                </kendo-textbox >
                            </kendo-floatinglabel>
                        </div>
                    </div>
                    <div class="flex-row">
                        <div class="flex-col flex-col-3">
                            <kendo-floatinglabel text="Refund Warrant #">
                                <kendo-textbox aria-label="Refund Warrant #" [fillMode]="formUiStyle.inputFillMode"
                                 formControlName="warantNumber">
                                </kendo-textbox>
                            </kendo-floatinglabel>
                            <kendo-formerror *ngIf="refundRXForm.hasError('required','warantNumber') && isRefundRxSubmitted">Refund Warrant # is required.
                            </kendo-formerror>
                        </div>
                    </div>
                    <div class="flex-row">
                        <div class="flex-col flex-col-3">
                            <kendo-floatinglabel text="Deposit Date">
                                <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode" aria-label="Deposit Date" formControlName="depositDate"
                                    format="MM/dd/yyyy" formatPlaceholder="formatPattern">
                                </kendo-datepicker>
                            </kendo-floatinglabel>
                            <kendo-formerror *ngIf="refundRXForm.hasError('required','depositDate') && isRefundRxSubmitted">Deposit Date is required.
                            </kendo-formerror>
                        </div>
                        <div class="flex-col flex-col-3">
                            <kendo-floatinglabel text="Refund Note (optional)">
                                <kendo-textbox aria-label="Refund Note (optional)"
                                    [fillMode]="formUiStyle.inputFillMode"
                                    formControlName="refundNote"
                                    [maxlength]="100"
                                    (valueChange)="onRefundNoteValueChange($event)">
                                </kendo-textbox>
                                <kendo-formhint class="justify-content-end"><span class="counter">
                                    {{refundNoteValueLength}}/100</span></kendo-formhint>
                            </kendo-floatinglabel>
                        </div>
                    </div>
                </div>
            </div>
            <div id="PharmacyPaymentsList">
                <h5>PHARMACY PAYMENTS FOR FNAME LNAME</h5>
                    <cms-vendor-refund-pharmacy-payments-list [vendorId]="vendorId" [clientId]="clientId"
                        [pageSizes]="pageSizes" [sortValue]="sortValuePharmacyPayment" [sortType]="sortType"
                        [sort]="sortPharmacyPayment"></cms-vendor-refund-pharmacy-payments-list>
            </div>
            </div>
        </div>


    </section>
</section>


<kendo-dialog-actions>
    <div class="justify-content-between" *ngIf="isConfirmationClicked">
<div>
    <button kendoButton [primary]="true" look="flat" aria-label="Select different Payments"
    class="button-lg" (click)="selectDiffPayments()"> Select different Payments
</button>
</div>
    <div class="justify-content-end align-items-center" >
        <span class="mr-2">0 payment(s) selected</span>
        <button kendoButton [primary]="true" look="outline" aria-label="Cancel" (click)="closeAddEditRefundFormModalClicked()"> Cancel </button>
        <button kendoButton [primary]="true" aria-label="Add" class="" (click)="onAddRefundClick()" > Add </button>
    </div>
</div>
    <div class="justify-content-end align-items-center" *ngIf="!isConfirmationClicked && selectedRefundType">
        
        <span class="mr-2">{{claimsCount}} refund(s) to be added</span>
        <button kendoButton [primary]="true" aria-label="Confirm Selections" [disabled]="claimsCount<1"  (click)="confirmationClicked()"> Confirm Selections
        </button>
    </div>

</kendo-dialog-actions>

<ng-template #providerDetailsTemplate>
    <cms-financial-premiums-provider-info
    [paymentRequestId]="paymentRequestId"
    (closeViewProviderDetailClickedEvent)="onCloseViewProviderDetailClicked($event)"
    (getProviderPanelEvent)="getProviderPanel($event)" [vendorProfile$]="vendorProfile$" 
    (updateProviderProfileEvent)="updateProviderProfile($event)" [updateProviderPanelSubject$]="updateProviderPanelSubject$"
    [ddlStates$]="ddlStates$" (onEditProviderProfileEvent)="OnEditProviderProfileClick()"
    [paymentMethodCode$]="paymentMethodCode$"></cms-financial-premiums-provider-info>
</ng-template>
