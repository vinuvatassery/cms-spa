<section class="k-dialog-body">
  <p class="text-muted mb-2">
    {{
    isEditViewPopup
    ? 'Click "Edit" to make changes to the insurance '
    : 'All fields are required unless otherwise stated.'
    }}
  </p>
  <div [formGroup]="healthInsuranceForm">

    <div class="flex-row">
      <div class="flex-col">

        <kendo-floatinglabel text="Health Insurance Type">
          <kendo-dropdownlist dropdownFieldautofocus aria-label="Health Insurance Type"
            [fillMode]="formUiStyle.dropDownFillMode" [data]="insuranceTypeList$ | async"
            (valueChange)="onHealthInsuranceTypeChanged()" formControlName="insuranceType" textField="lovDesc"
            valueField="lovCode" [disabled]="isViewContentEditable || isEdit" [valuePrimitive]="true"
            [loading] = "(insuranceTypeList$ | async)?.length===0" >
          </kendo-dropdownlist>
        </kendo-floatinglabel>
      </div>
    </div>

    <div class="flex-row" *ngIf="isOpenDdl && ddlInsuranceType === InsurancePlanTypes.Medicare">
      <div class="block-section">
        <div class="flex-col mt-3">
          <h5 class="text-capital">Medicare Info</h5>
        </div>
        <div class="flex-col">
          <kendo-floatinglabel text="Medicare Benificiary ID Number">
            <kendo-textbox [disabled]="isViewContentEditable" aria-label="Medicare Benificiary ID Number"
              placeholder="Medicare Benificiary ID Number" formControlName="medicareBeneficiaryIdNbr" [maxlength]="20"
              [fillMode]="formUiStyle.inputFillMode">
            </kendo-textbox>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['medicareBeneficiaryIdNbr'].valid">Medicare Benificiary
            ID Number is required.</kendo-formerror>
        </div>
        <div class="flex-col">
          <kendo-floatinglabel text="Medicare Coverage Type">
            <kendo-dropdownlist aria-label="Medicare Coverage Type" [fillMode]="formUiStyle.dropDownFillMode"
              [data]="medicareCoverageTypeList$ | async" (valueChange)="onMedicareCoverageTypeChanged()"
              formControlName="medicareCoverageTypeCode" textField="lovDesc" valueField="lovCode"
              [disabled]="isViewContentEditable" [valuePrimitive]="true">
            </kendo-dropdownlist>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['medicareCoverageTypeCode'].valid">Medicare Coverage
            Type is required.</kendo-formerror>
        </div>
        <div class="flex-col">
          <kendo-floatinglabel text="Medicare Part A Start Date">
            <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode" format="MM-dd-yyyy"
              aria-label="Medicare Part A Start Date" formControlName="medicarePartAStartDate"
              [disabled]="isViewContentEditable" formatPlaceholder="formatPattern" placeholder="">
            </kendo-datepicker>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['medicarePartAStartDate'].valid">Medicare Part A Start
            Date is required.</kendo-formerror>
        </div>
        <div class="flex-col">
          <kendo-floatinglabel text="Medicare Part B Start Date">
            <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode" format="MM-dd-yyyy"
              aria-label="Medicare Part B Start Date" formControlName="medicarePartBStartDate"
              [disabled]="isViewContentEditable" formatPlaceholder="formatPattern" placeholder="">
            </kendo-datepicker>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['medicarePartBStartDate'].valid">Medicare Part B Start
            Date is required.</kendo-formerror>
        </div>
        <div class="flex-col mt-2">
          <span class="app-checkboxwidtext-wrapper">
            <input [disabled]="isViewContentEditable" type="checkbox" kendoCheckBox aria-labelledby="qmb" id="qmb"
              formControlName="onQmbFlag" />
            <label class="k-checkbox-label" for="qmb">On Qualified Medicare Beneficiary (QMB)</label>
          </span>
        </div>
        <div class="flex-col">

          <fieldset class="k-form-fieldset">
            <legend class="k-form-legend">
              <h5>On Low Income Subsidy (LIS)?</h5>
            </legend>
            <div class="component-list-h">
              <span class="app-radiobtnwidtext-wrapper">
                <input type="radio" [disabled]="isViewContentEditable" kendoRadioButton name="onLisFlag"
                  aria-labelledby="LowIncomeSusidyYes" formControlName="onLisFlag" id="LowIncomeSusidyYes" value="Y" />
                <kendo-label class="k-radio-label" for="LowIncomeSusidyYes" text="Yes"></kendo-label>
              </span>
              <span class="app-radiobtnwidtext-wrapper">
                <input type="radio" [disabled]="isViewContentEditable" kendoRadioButton name="onLisFlag"
                  aria-labelledby="LowIncomeSusidyNo" formControlName="onLisFlag" id="LowIncomeSusidyNo" value="N" />
                <kendo-label class="k-radio-label" for="LowIncomeSusidyNo" text="No"></kendo-label>
              </span>
              <kendo-formerror
                *ngIf="!healthInsuranceForm.controls['onLisFlag'].valid && isViewContentEditable==false">On Low Income
                Subsidy (LIS) is required.</kendo-formerror>
            </div>
          </fieldset>
        </div>
        <div class="flex-col mb-2 mt-2 file-uploads">
          <h5 class="text-capital">Copy of Medicare Card</h5>
          <kendo-upload aria-label="copy of insurance" name="copyOfMediacreCard" [disabled]="isViewContentEditable"
            [multiple]="false" [autoUpload]="false" (select)="handleFileSelected($event, 'medicareCard')"
            (remove)="handleFileRemoved(copyOfMedicareCardFiles, 'medicareCard')" #copyOfInsurance
            [removeUrl]="uploadRemoveUrl" [ngModel]="copyOfMedicareCardFiles" [ngModelOptions]="{standalone: true}"
            [restrictions]="uploadFileRestrictions.fileRestrictions">
            <ng-template kendoUploadFileInfoTemplate let-files let-state="state">
              <span (click)="clientDocumentFacade.viewOrDownloadFile('view',files[0].documentId,files[0].name)">
                <span *ngIf="!files[0].documentId">{{files[0].name}} </span>
                <button aria-label="doc name" *ngIf="files[0].documentId" kendoButton look="flat"
                  class="card-link-button">
                  <a>{{ files[0].name }} </a>
                </button>
                <br>
                <span>{{files[0].size | fileSize}}</span>
              </span>
            </ng-template>
          </kendo-upload>
          <kendo-formhint>Max file size 25MB</kendo-formhint>
          <kendo-formerror *ngIf="medicareCardFilesExceedsFileSizeLimit">File size is limited to 25 MB. Please select a
            smaller file. </kendo-formerror>
          <kendo-formerror
            *ngIf="!isMedicareCardFileUploaded && isViewContentEditable==false && !medicareCardFilesExceedsFileSizeLimit">
            Medicare Card is required.</kendo-formerror>
        </div>
      </div>
    </div>

    <div *ngIf="isOpenDdl && medicareInsuranceInfoCheck">
      <div class="flex-row" *ngIf="ddlInsuranceType !== InsurancePlanTypes.Veterans">
        <div class="flex-col mt-3">
          <h5 class="text-capital">Insurance Info</h5>
        </div>
        <div class="flex-col flex-col-6">
          <kendo-floatinglabel text="Insurance Start Date">
            <kendo-datepicker aria-label="Insurance Start Date" [fillMode]="formUiStyle.dateInputFillMode"
              format="MM-dd-yyyy" formControlName="insuranceStartDate" [disabled]="isViewContentEditable"
              formatPlaceholder="formatPattern" placeholder="" (valueChange)="startDateOnChange()">
            </kendo-datepicker>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['insuranceStartDate'].valid ">Insurance Start Date is
            required.</kendo-formerror>
        </div>
        <div class="flex-col flex-col-6">
          <kendo-floatinglabel text="Insurance End Date">
            <kendo-datepicker aria-label="Insurance End Date" [fillMode]="formUiStyle.dateInputFillMode"
              format="MM-dd-yyyy" [min]="endDateMin" (focus)="changeMinDate()" (blur)="endDateOnChange()"
              (valueChange)="endDateValueChange($event)" [disabled]="isViewContentEditable"
              formControlName="insuranceEndDate" formatPlaceholder="formatPattern" placeholder="">
            </kendo-datepicker>
          </kendo-floatinglabel>
          <kendo-formerror
            *ngIf="!healthInsuranceForm.controls['insuranceEndDate'].valid && insuranceEndDateIsgreaterthanStartDate">Insurance
            End Date is required.</kendo-formerror>
          <kendo-formerror
            *ngIf="!healthInsuranceForm.controls['insuranceEndDate'].valid && !insuranceEndDateIsgreaterthanStartDate">End Date must be after Start Date.</kendo-formerror>
        </div>
        <div class="flex-col">
          <kendo-floatinglabel text="Insurance ID Number">
            <kendo-textbox [disabled]="isViewContentEditable" aria-label="lainsurance id number"
              placeholder="Insurance ID Number" formControlName="insuranceIdNumber" [maxlength]="20"
              [fillMode]="formUiStyle.inputFillMode" (keypress)="restrictSpecialChar($event)">
            </kendo-textbox>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['insuranceIdNumber'].valid && !specialCharAdded">
            Insurance ID Number is required.</kendo-formerror>
          <kendo-formerror *ngIf="!healthInsuranceForm.controls['insuranceIdNumber'].valid && specialCharAdded">
            Special characters not allowed.</kendo-formerror>
        </div>
        <div class="flex-col mat-form-sm-b-space">
          <case-management-medical-premium-detail-insurance-carrier-name [healthInsuranceForm]="healthInsuranceForm"
            [isViewContentEditable]="isViewContentEditable"
            (insuranceCarrierNameChange)="insuranceCarrierNameChange($event)"
            (insuranceCarrierNameData)="insuranceCarrierNameData($event)"></case-management-medical-premium-detail-insurance-carrier-name>
        </div>

        <div class="flex-col mat-form-sm-b-space ">
          <case-management-medical-premium-detail-insurance-plan-name [healthInsuranceForm]="healthInsuranceForm"
          [insurancePlans]="insurancePlans"
            [isViewContentEditable]="isViewContentEditable"></case-management-medical-premium-detail-insurance-plan-name>
        </div>
        <div class="flex-col"
          *ngIf="ddlInsuranceType === InsurancePlanTypes.QualifiedHealthPlan || ddlInsuranceType === InsurancePlanTypes.OffExchangePlan">
          <case-management-medical-premium-detail-metal-level [healthInsuranceForm]="healthInsuranceForm"
            [isViewContentEditable]="isViewContentEditable" [isEdit]="isEdit"
            [defaultValue]="metalLevelDefaultValue"></case-management-medical-premium-detail-metal-level>
        </div>
        <div
          *ngIf="ddlInsuranceType !== InsurancePlanTypes.OregonHealthPlan && healthInsuranceForm.controls['insuranceCarrierName'].value">
          <case-management-medical-carrier-contact-info [carrierContactInfo]="carrierContactInfo"></case-management-medical-carrier-contact-info>
        </div>
        <div class="flex-col mt-3" *ngIf="ddlInsuranceType === InsurancePlanTypes.GroupInsurancePlan">
          <case-management-medical-premium-detail-group-plan-type [healthInsuranceForm]="healthInsuranceForm"
            [isViewContentEditable]="isViewContentEditable"></case-management-medical-premium-detail-group-plan-type>
        </div>

        <div class="flex-col mt-3" *ngIf="ddlInsuranceType === InsurancePlanTypes.QualifiedHealthPlan">
          <case-management-medical-premium-detail-aptc [healthInsuranceForm]="healthInsuranceForm"
            [isViewContentEditable]="isViewContentEditable"></case-management-medical-premium-detail-aptc>
        </div>
        <div class="flex-col mt-3"
          *ngIf="ddlInsuranceType === InsurancePlanTypes.QualifiedHealthPlan || ddlInsuranceType === InsurancePlanTypes.OffExchangePlan || ddlInsuranceType === InsurancePlanTypes.GroupInsurancePlan || ddlInsuranceType === InsurancePlanTypes.Cobra || ddlInsuranceType === InsurancePlanTypes.Medicare">
          <case-management-medical-premium-detail-careassist-pay [healthInsuranceForm]="healthInsuranceForm"
            [isViewContentEditable]="isViewContentEditable" [sameAsInsuranceIdFlag]="sameAsInsuranceIdFlag"
            [ddlInsuranceType]="ddlInsuranceType"
            [clientId]="clientId"></case-management-medical-premium-detail-careassist-pay>
        </div>

      </div>


      <div class="flex-col mb-2 mt-2  file-uploads" *ngIf="(ddlInsuranceType === InsurancePlanTypes.QualifiedHealthPlan || ddlInsuranceType === InsurancePlanTypes.OffExchangePlan || ddlInsuranceType === InsurancePlanTypes.GroupInsurancePlan || ddlInsuranceType === InsurancePlanTypes.Cobra || ddlInsuranceType === InsurancePlanTypes.Medicare)
          && healthInsuranceForm.controls['careassistPayingPremiumFlag'].value === 'Y'">
        <h5 class="text-capital">Proof of premium amount</h5>
        <kendo-upload aria-label="proof of premium" name="proofOfPremium" [disabled]="isViewContentEditable"
          [multiple]="false" [autoUpload]="false" (select)="handleFileSelected($event, 'proof')"
          (remove)="handleFileRemoved(proofOfPremiumFiles, 'proof')" #proofOfPremium [removeUrl]="uploadRemoveUrl"
          [ngModel]="proofOfPremiumFiles" [ngModelOptions]="{standalone: true}"
          [restrictions]="uploadFileRestrictions.fileRestrictions">
          <ng-template kendoUploadFileInfoTemplate let-files let-state="state">
            <span (click)="clientDocumentFacade.viewOrDownloadFile('view',files[0].documentId,files[0].name)">
              <span *ngIf="!files[0].documentId">{{files[0].name}} </span>
              <button aria-label="doc name" *ngIf="files[0].documentId" kendoButton look="flat"
                class="card-link-button">
                <a>{{ files[0].name }} </a>
              </button>
              <br>
              <span>{{files[0].size}}</span>
            </span>
          </ng-template>
        </kendo-upload>
        <kendo-formhint>Max file size 25MB</kendo-formhint>
        <kendo-formerror
          *ngIf="healthInsuranceForm.value.careassistPayingPremiumFlag === 'Y' && !isProofFileUploaded && !isViewContentEditable && !proofOfPremiumExceedsFileSizeLimit">Proof
          of premium is required. </kendo-formerror>
        <kendo-formerror
          *ngIf="healthInsuranceForm.value.careassistPayingPremiumFlag === 'Y' && !isViewContentEditable && proofOfPremiumExceedsFileSizeLimit">
          File size is limited to 25 MB. Please select a smaller file.
        </kendo-formerror>

      </div>
      <div class="flex-col mb-2  file-uploads"
        *ngIf="ddlInsuranceType === InsurancePlanTypes.GroupInsurancePlan || ddlInsuranceType === InsurancePlanTypes.Cobra">
        <h5 class="text-capital">Copy of Summary of Benefits</h5>
        <kendo-upload aria-label="copy Of Summary" name="copyOfSummary" [disabled]="isViewContentEditable"
          [multiple]="false" [autoUpload]="false" (select)="handleFileSelected($event, 'summary')"
          (remove)="handleFileRemoved(copyOfSummaryFiles, 'summary')" #copyOfSummary [removeUrl]="uploadRemoveUrl"
          [ngModel]="copyOfSummaryFiles" [ngModelOptions]="{standalone: true}"
          [restrictions]="uploadFileRestrictions.fileRestrictions">
          <ng-template kendoUploadFileInfoTemplate let-files let-state="state">
            <span (click)="clientDocumentFacade.viewOrDownloadFile('view',files[0].documentId,files[0].name)">
              <span *ngIf="!files[0].documentId">{{files[0].name}} </span>
              <button aria-label="doc name" *ngIf="files[0].documentId" kendoButton look="flat"
                class="card-link-button">
                <a>{{ files[0].name }} </a>
              </button>
              <br>
              <span>{{files[0].size | fileSize}}</span>
            </span>
          </ng-template>
        </kendo-upload>
        <kendo-formhint>Max file size 25MB</kendo-formhint>
        <kendo-formerror *ngIf="summaryFilesExceedsFileSizeLimit">File size is limited to 25 MB. Please select a smaller
          file. </kendo-formerror>
        <kendo-formerror *ngIf="!isSummaryFileUploaded && !summaryFilesExceedsFileSizeLimit">
          Summary of Benefits is required.
        </kendo-formerror>
      </div>
    </div>
    <div *ngIf="isOpenDdl">
      <div class="flex-col mb-2 mt-2 file-uploads"
        *ngIf="ddlInsuranceType === InsurancePlanTypes.QualifiedHealthPlan || ddlInsuranceType === InsurancePlanTypes.OffExchangePlan || ddlInsuranceType === InsurancePlanTypes.GroupInsurancePlan || ddlInsuranceType === InsurancePlanTypes.Cobra || ddlInsuranceType === InsurancePlanTypes.Medicare">
        <h5 class="text-capital">Copy of Insurance Card</h5>
        <kendo-upload aria-label="copy of insurance" name="copyOfInsuranceCard" [disabled]="isViewContentEditable"
          [multiple]="false" [autoUpload]="false" (select)="handleFileSelected($event, 'copyInsurance')"
          (remove)="handleFileRemoved(copyOfInsuranceCardFiles, 'copyInsurance');" #copyOfInsurance
          [removeUrl]="uploadRemoveUrl" [ngModel]="copyOfInsuranceCardFiles" [ngModelOptions]="{standalone: true}"
          [restrictions]="uploadFileRestrictions.fileRestrictions">
          <ng-template kendoUploadFileInfoTemplate let-files let-state="state">
            <span (click)="clientDocumentFacade.viewOrDownloadFile('view',files[0].documentId,files[0].name)">
              <span *ngIf="!files[0].documentId">{{files[0].name}} </span>
              <button aria-label="doc name" *ngIf="files[0].documentId" kendoButton look="flat"
                class="card-link-button">
                <a>{{ files[0].name }} </a>
              </button>
              <br>
              <span>{{files[0].size | fileSize}}</span>
            </span>
          </ng-template>
        </kendo-upload>
        <kendo-formhint>Max file size 25MB</kendo-formhint>
        <kendo-formerror *ngIf="insuranceCardFilesExceedsFileSizeLimit">File size is limited to 25 MB. Please select a
          smaller file. </kendo-formerror>
        <kendo-formerror
          *ngIf="!isInsuranceFileUploaded && !isViewContentEditable && !insuranceCardFilesExceedsFileSizeLimit">Copy of
          insurance card is required. </kendo-formerror>
      </div>
    </div>
  </div>
</section>

<kendo-dialog-actions>
  <div class="justify-content-between">
    <div>
      <button kendoButton class="k-danger-link" *ngIf="isDeleteEnabled" (click)="onDeleteClick()"
        aria-label="delete medical premium">
        Delete
      </button>
      <button kendoButton [primary]="true" (click)="onRedirectModalClicked()" *ngIf="isEditViewPopup" look="outline"
        aria-label="edit medical premium">
        Edit
      </button>
    </div>
    <div class="justify-content-end">
      <button kendoButton [primary]="true" look="outline" *ngIf="!isEditViewPopup && isOpenDdl"
        (click)="onModalCloseClicked()" aria-label="cancel adding medical premium">
        Cancel
      </button>
      <button kendoButton [primary]="true" *ngIf="!isEditViewPopup && isOpenDdl" aria-label="add new medical premium"
        (click)="save()" [disabled]="btnDisabled">
        {{buttonText}}
      </button>
      <button kendoButton [primary]="true" *ngIf="isEditViewPopup" (click)="onModalCloseClicked()"
        aria-label="close medical premium">
        Close
      </button>
    </div>
  </div>
</kendo-dialog-actions>
