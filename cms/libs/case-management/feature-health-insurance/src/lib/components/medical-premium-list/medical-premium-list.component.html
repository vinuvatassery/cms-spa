<kendo-popover #myPopover body="Popover Body" >
  <ng-template kendoPopoverBodyTemplate>
    <case-management-medical-carrier-contact-info [carrierContactInfo]="carrierContactInfo" [insurancePlan]="insurancePlanName"></case-management-medical-carrier-contact-info>
  </ng-template>
</kendo-popover>

<div class="flex-row">
  <div class="flex-col">
    <div class="app-c-table">
      <kendo-grid [data]="medicalHealthPlans$ |async" #employersGrid [pageSize]="state.take" [pageable]="true"
      [sortable]="true" [skip]="state.skip" [groupable]="false" [reorderable]="true" [resizable]="true"
      [columnMenu]="{ filter: true }" [sort]="state.sort" (dataStateChange)="dataStateChange($event)">

      <kendo-grid-column *ngIf="isCerForm" field="ReviewInsurance" title="Review Insurance" [width]="100" [sortable]="false">
        <ng-template kendoGridCellTemplate let-dataItem>
          <button  
            *ngIf="dataItem.cerReviewStatusCode === 'PENDING' || dataItem.cerReviewStatusCode === 'START_REVIEW'" 
            kendoButton look="flat"  
            themeColor="error" 
            class="card-link-button" 
            aria-label="Start Review"
            (click)="handleHealthInsuranceOpenClicked('review')"
            (click)="handleInsuranceType(dataItem)"> 
            <span class="material-icons"> error  </span>Start Review   </button>
          <button  
            *ngIf="dataItem.cerReviewStatusCode === 'REVIEWED'" 
            kendoButton look="flat"  
            themeColor="success" 
            class="card-link-button" 
            aria-label="Reviewed">  
            <span class="material-icons"> check_circle </span>  Reviewed   
          </button>
        
        </ng-template>
      </kendo-grid-column>
        <kendo-grid-column field="FullDetail" title="Full Detail" [width]="75" [sortable]="false">
          <ng-template kendoGridCellTemplate let-dataItem><button kendoButton look="flat" class="card-link-button"
              (click)="handleHealthInsuranceOpenClicked('view')" (click)="handleInsuranceType(dataItem)"
              aria-label="view medical premium">
              View
            </button></ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="healthInsuranceTypeDesc" title="Health Insurance Type"
          [width]="140"></kendo-grid-column>
        <kendo-grid-column field="priorityDesc" title="Priority" [width]="100">
        </kendo-grid-column>
        <kendo-grid-column field="insuranceCarrierName" title="Insurance Carrier Name" [width]="150">
          <ng-template kendoGridCellTemplate let-dataItem>
            <button kendoButton look="flat" class="card-link-button"
              aria-label="carrier name"
              kendoPopoverAnchor
              [popover]="myPopover"
              (click)="getCarrierContactInfo(dataItem.insuranceVendorId,'')"
              >
              {{ dataItem.insuranceCarrierName }}
            </button></ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="insurancePlanName" title="Insurance Plan Name" [width]="150">
          <ng-template kendoGridCellTemplate let-dataItem><button kendoButton look="flat" class="card-link-button"
              aria-label="plan name"
              kendoPopoverAnchor
              [popover]="myPopover"
              (click)="getCarrierContactInfo(dataItem.insuranceVendorId,dataItem.insurancePlanName)"
              >
              {{ dataItem.insurancePlanName }}
            </button></ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="premiumAmt" title="Premium Paid" [width]="110"></kendo-grid-column>
        <kendo-grid-column field="premiumFrequencyDesc" title="Frequency" [width]="110"></kendo-grid-column>
        <kendo-grid-column field="startDate" title="Start Date" [width]="110">
          <ng-template kendoGridCellTemplate let-dataItem>
            {{dataItem.startDate |date: 'MM/dd/yyyy'}}
          </ng-template>

        </kendo-grid-column>
        <kendo-grid-column field="endDate" title="End Date" [width]="110">
          <ng-template kendoGridCellTemplate let-dataItem>
            {{dataItem.endDate |date: 'MM/dd/yyyy'}}
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="careassistPayingPremiumFlag" title="CAREAssist paying premium?" [width]="150"
          class="text-center">
        </kendo-grid-column>
        <kendo-grid-column field="Option" title="Options" [width]="75" [sticky]="true" class="text-center"  [filterable]="columnOptionDisabled" [columnMenu]="columnOptionDisabled" [sortable]="columnOptionDisabled">
          <ng-template kendoGridCellTemplate let-dataItem>
            <kendo-dropdownbutton [data]="actions" icon="more-vertical"    title="More option" class="TableActionPopup app-dropdown-action more_action_wid"
              buttonClass="k-icon-button" aria-label="more actions"
              [popupSettings]="{ popupClass: popupClassAction, animate: true }">
              <span hidden> More Option</span>
              <ng-template class="app-dropdown-action-list" kendoDropDownButtonItemTemplate let-buttondataItem>
                <button kendoButton look="flat" [attr.aria-label]="buttondataItem.text" [class]="buttondataItem.buttonType"
                  aria-hidden="false" (click)="handleOptionClick(dataItem,buttondataItem.type)"
                  [hidden]="dataItem.healthInsuranceTypeCode ==='VETERANS_ADMINISTRATION' && buttondataItem.btnName ==='copy'">
                  <span class="material-icons" [attr.aria-label]="buttondataItem.text">{{buttondataItem.icon}}</span>
                  <label> {{ buttondataItem.btnName === 'delete' && isCerForm === true ? 'Remove Insurance' : buttondataItem.text }} </label>
                </button>
              </ng-template>
            </kendo-dropdownbutton>
          </ng-template>
        </kendo-grid-column>
        <!-- Column ended -->
        <!-- grid Pagination template -->
        <ng-template kendoPagerTemplate let-totalPages="totalPages" let-pagerFirstPage="pagerFirstPage"
          let-currentPage="currentPage">
          <div class="grid-custom-paginationtemplates d-flex">
            <div class="d-flex align-items-center">
              <label class="mr-1" for="RowsPerPage">Rows Per Page</label>
              <kendo-dropdownlist [fillMode]="formUiStyle.dropDownFillMode" [data]="pageSizes" [textField]="'text'"
                [valueField]="'value'" [valuePrimitive]="true" [(value)]="state.take"
                (selectionChange)="pageselectionchange($event)" aria-label="Rows Per Page" id="RowsPerPage"></kendo-dropdownlist>
              <kendo-pager-info> </kendo-pager-info>
              <kendo-grid-messages [pagerItems]="' '" [pagerPage]="'Page'"> </kendo-grid-messages>
            </div>
            <div class="d-flex">
              <kendo-pager-input></kendo-pager-input>
              <kendo-pager-prev-buttons></kendo-pager-prev-buttons>
              <kendo-pager-next-buttons></kendo-pager-next-buttons>
            </div>
          </div>
        </ng-template>
 <!-- grid Loader Template -->  
 <ng-template kendoGridLoadingTemplate>
  <common-grid-loader-component></common-grid-loader-component>
 </ng-template>
 <!-- grid No data Template -->  
 <ng-template kendoGridNoRecordsTemplate>
   <div> <kendo-badge-container>   <span class="material-icons">    info   </span>    </kendo-badge-container>
   </div>
   <p>There is no data to display.</p>
 </ng-template> 
      </kendo-grid>
      <kendo-formerror *ngIf="showInsuranceRequired | async"> A Response is required.</kendo-formerror>
    </div>
    <div class="flex-row">
      <div class="flex-col mt-1">
        <button kendoButton [primary]="true" icon="add" (click)="handleHealthInsuranceOpenClicked('add')"
          aria-label="add health insurance">
          Health Insurance
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add Health Insurance  Modal -->
<kendo-dialog *ngIf="isOpenedHealthInsuranceModal" (close)="handleHealthInsuranceCloseClicked()"
  class="app-c-modal app-c-modal-mdl app-c-modal-np">
  <kendo-dialog-titlebar>
    {{ dialogTitle + ' Health Insurance' }}
  </kendo-dialog-titlebar>
  <case-management-medical-premium-detail [dialogTitle]="dialogTitle"
    (isCloseInsuranceModal)="handleHealthInsuranceCloseClicked()"
    (editRedirect)="handleHealthInsuranceOpenClicked('edit')" [insuranceType]="insuranceType"
    [healthInsuranceForm]="healthInsuranceForm" (isDeleteClicked)="deleteButonClicked($event)" (isAddEditClicked)="addOrEditClicked($event)"
    [medicalHealthPlansCount]="medicalHealthPlansCount"
    (isAddPriority)="isAddPriority($event)"
    [caseEligibilityId]="caseEligibilityId"
    [clientId] ="clientId">
  </case-management-medical-premium-detail>
</kendo-dialog>

<!-- Change Priority Modal -->
<kendo-dialog *ngIf="isOpenedChangePriorityModal" (close)="onChangePriorityCloseClicked()"
  class="app-c-modal app-c-modal-md app-c-modal-np">
  <kendo-dialog-titlebar>{{
    isEditInsurancePriorityTitle
        ? 'Change Insurance Priority'
        : 'Select Insurance Priority'
    }}</kendo-dialog-titlebar>
  <case-management-set-health-insurance-priority [insurancePriorityModalButtonText]="insurancePriorityModalButtonText" [selectedInsurance]="selectedInsurance"  [clientId]="clientId" [caseEligibilityId]="caseEligibilityId" (isCloseInsuranceModal)="onChangePriorityCloseClicked()"(priorityAdded)="priorityAdded()"></case-management-set-health-insurance-priority>
</kendo-dialog>

<!-- Delete Modal -->
<kendo-dialog *ngIf="isOpenedDeleteConfirm" (close)="onDeleteConfirmCloseClicked()"
  class="app-c-modal app-c-modal-sm app-c-modal-np">
  <kendo-dialog-titlebar> Delete Health Insurance? </kendo-dialog-titlebar>
  <section class="k-dialog-body mb-2">
    <p>
      The clientâ€™s personal insurance info will be permanently deleted, and the
      insurance carriers and plans will no longer be associated with this
      client.
    </p>
  </section>
  <kendo-dialog-actions>
    <div class="justify-content-between">
      <div class="justify-content-end">
        <button kendoButton [primary]="true" look="outline" aria-label="cancel adding health insurance" (click)="onDeleteConfirmCloseClicked()">
          Cancel
        </button>
        <button kendoButton class="k-error-button" aria-label="delete health insurance" (click)="deleteInsurancePolicy()">
          Delete
        </button>
      </div>
    </div>
  </kendo-dialog-actions>
</kendo-dialog>


<!-- Change Priority Modal -->
<kendo-dialog *ngIf="isOpenedRemoveConfirm" (close)="onRemoveCloseClicked()"
  class="app-c-modal app-c-modal-md app-c-modal-np">
  
  <case-management-deactivate-premium-confirmation  
   (deactivateConfimEvent)="onRemoveConfirmCloseClicked($event)">
  </case-management-deactivate-premium-confirmation>
</kendo-dialog>