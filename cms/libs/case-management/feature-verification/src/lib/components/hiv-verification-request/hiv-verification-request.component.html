<section [formGroup]="hivVerificationForm">
  <div *ngIf="!isSendRequest">
    <div class="flex-row "
      [ngClass]="{'sendrequest-fieldwithbtn' : (providerValue$ | async) === 'HEALTHCARE_PROVIDER'} ">
      <div class="flex-col flex-col-6" *ngIf="isEmailFieldVisible">
        <kendo-floatinglabel text="Healthcare Provider’s Email Address">
          <kendo-textbox aria-label="healthcare providers email address"
            placeholder="Healthcare Provider’s Email Address" [fillMode]="formUiStyle.inputFillMode"
            formControlName="providerEmailAddress">
          </kendo-textbox>
        </kendo-floatinglabel>
        <kendo-formerror
          *ngIf="!hivVerificationForm.controls['providerEmailAddress'].valid && hivVerificationForm.controls['providerEmailAddress'].value !== ''">Enter
          valid Email Address.</kendo-formerror>
        <kendo-formerror
          *ngIf="!hivVerificationForm.controls['providerEmailAddress'].valid && hivVerificationForm.controls['providerEmailAddress'].value === ''">Healthcare
          Provider Email Address is required.</kendo-formerror>
      </div>
      <div *ngIf="providerOption === 'CASE_MANAGER' || providerOption === 'HEALTHCARE_PROVIDER'"
        class="mt-2 flex-col flex-col-5">
        <button kendoButton [primary]="true" class="overlap_right_btn" (click)="onSendRequestClicked()"
          *ngIf="!isSendRequest" aria-label="send request">
          Send request
        </button>
      </div>
    </div>
    <div class="flex-row ">
      <div class="flex-col flex-col-8">
        <kendo-formhint *ngIf="providerOption === 'CASE_MANAGER'">Their Case Manager will receive a notification to
          provide HIV
          Verification. Once they submit the form, you will receive a notification
          to approve or deny it.</kendo-formhint>
        <kendo-formhint *ngIf="isEmailFieldVisible">Their provider will receive an email to fill and sign an HIV
          Verification form.
          Once they submit the form, you will receive a notification to approve or deny it.</kendo-formhint>
      </div>
    </div>
    <div class="flex-row ml-4" *ngIf="providerOption === 'UPLOAD_ATTACHMENT'">
      <div class="flex-col">
        <div class="component-list-h">
          <span class="app-checkboxwidtext-wrapper">
            <input type="radio" kendoRadioButton id="upoadattachment" value="upoadattachment" name="upoadattachment"
              aria-labelledby="upoadattachment" formControlName="attachmentType" value="Attach From Computer"  />

            <kendo-label class="k-radio-label" for="upoadattachment" text="Attach From Computer"></kendo-label>

          </span>
          <span class="app-checkboxwidtext-wrapper">
            <input type="radio" kendoRadioButton id="upoadattachment" value="upoadattachment" name="upoadattachment"
              aria-labelledby="upoadattachment" formControlName="attachmentType" value="Attach From Client Attachments" />

            <kendo-label class="k-radio-label" for="upoadattachment"
              text="Attach From Client Attachments"></kendo-label>

          </span>
        </div>
      </div>
      <!-- Select file form computer [ngModel]="homeAddressProofFile" [ngModelOptions]="{standalone: true}"-->
      <div *ngIf="hivVerificationForm.controls['attachmentType'].value == 'Attach From Computer'" class="flex-col flex-col-6 ml-1  mt-2">
        <kendo-fileselect 
            aria-label="proof of home address"  
            name="upload proof"
            [multiple]="false"   
            (select)="handleFileSelected($event)" 
            (remove)="handleFileRemoved($event)"
            id="verificationAttachmentUploaded"
            #verificationAttachmentUploaded>
            <ng-template kendoUploadFileInfoTemplate let-files let-state="state">
              <span (click)="clientDocumentFacade.viewOrDownloadFile('view',files[0].documentId,files[0].name)">
              <span *ngIf="!files[0].documentId">{{ files[0].name }} </span>   
                <button aria-label="doc name" *ngIf="files[0].documentId" kendoButton look="flat" class="card-link-button"  >
                  <a>{{ files[0].name }} </a>
                </button>
                <br>
                <span>{{   files[0].size  | fileSize  }}</span> 
              </span>
            </ng-template>
          </kendo-fileselect>
          <kendo-formhint>Max file size {{fileSize}}MB</kendo-formhint> 
          <kendo-formerror *ngIf="showHivVerificationAttachmentRequiredValidation"> Proof of Home Address is required
          </kendo-formerror>
          <kendo-formerror *ngIf="showHivVerificationAttachmentSizeValidation">File size is limited to 25 MB. Please select a smaller file. </kendo-formerror>
      </div>
      <!-- Select file form client attachment --> 
      <div *ngIf="hivVerificationForm.controls['attachmentType'].value == 'Attach From Client Attachments'" class="flex-col flex-col-8 mt-2 ml-1">
        <kendo-floatinglabel text="Client Documents">
         
          <span *ngIf="showDocInputLoader" class=" k-icon k-i-loading k-input-loading-icon input-inline-loader"  ></span>
          <kendo-multicolumncombobox         
            [data]="clientDocList"
            textField="clientDocumentsName"
            valueField="clientDocumentsId"
            autofocusfield
            id="clientdocuments"
            #searchcaseornew
            [loading] = "showDocInputLoader" 
            [fillMode]="formUiStyle.dropDownFillMode"
            [popupSettings]="{popupClass: 'case-search-footer combotable_search_list',  appendTo:'component' ,animate: true }"
            [filterable]="true"
         >
            <kendo-combobox-column >
              <ng-template   kendoMultiColumnComboBoxColumnCellTemplate  let-dataItem  >
                <span  >{{ dataItem.clientDocumentsName }}</span>
              </ng-template>
            </kendo-combobox-column>
            <kendo-combobox-column  [width]="200">
              <ng-template   kendoMultiColumnComboBoxColumnCellTemplate  let-dataItem  >
                <span>  {{dataItem.documentType}}</span>
              </ng-template>
            </kendo-combobox-column>
          </kendo-multicolumncombobox>
        </kendo-floatinglabel>
      <div class="attachment-from-client-lists-wrapper mt-2">
         
        <div class="attachment-from-client-lists-container">

          <div class="attachment-from-client-lists">
            <span class="material-icons">
              file_present
            </span>
            <div>
              <span>DOCUMENT NAME</span> 
            </div>
            <kendo-dropdownbutton [data]="data" icon="more-vertical" title="More option" look="bare"
              aria-label="more actions" class="small-i-btn app-dropdown-action hide_more-text"
              [popupSettings]="{ popupClass: popupClass1, animate: true }">
              <span hidden> More Option</span>
              <ng-template class="app-dropdown-action-list" kendoDropDownButtonItemTemplate let-dataItem>
                <button kendoButton look="flat" [attr.aria-label]="dataItem.text" [class]="dataItem.buttonType"
                  aria-hidden="false" (click)="dataItem.click">
                  <span class="material-icons" [attr.aria-label]="dataItem.text">{{dataItem.icon}}</span>
                  <label> {{ dataItem.text }} </label>
                </button>
              </ng-template>
            </kendo-dropdownbutton>
          </div>
          <p>Uploaded by    
            <button kendoButton class="k-primary-link text-t-normal text-underline" kendoPopoverAnchor
            [popover]="onUserProfileDetailsHovered" showOn="hover" #refresh aria-label="user profile">
            Lisa McAuliffe
          </button> 
          on xx/xx/xxxxx</p>
        </div>
      
      </div>
    </div>
    </div>
  </div>
</section>

<!-- Show this after send a request -->
<section>
  <div *ngIf="isSendRequest || isResendRequest">
    <div class="flex-row mt-3 align-items-center">
      <div class="flex-col">
        <span class="app-c-badge badge-primary">
          <span class="material-icons" aria-label="information" aria-hidden="true" #refresh>info_outline</span>
          <span>You will receive a notification once the provider submits the HIV Verification</span>
        </span>
      </div>
      <div class="flex-col mt-1">
        Sent {{sentDate | date:'MM-dd-yyyy'}}
        <button kendoButton class="k-primary-link text-t-normal text-underline" kendoPopoverAnchor
          [popover]="onUserProfileDetailsHovered" showOn="hover" #refresh aria-label="user profile">
          {{hivVerificationForm.controls["requestedUserName"].value}}
        </button>
        <button kendoButton class="k-primary-link text-t-normal ml-2 text-underline" (click)="onResendRequestClicked()"
          aria-label="re send request">
          Re-send Request
        </button>
      </div>
    </div>
  </div>
</section>

<!-- User Profile Details Card -->

<kendo-popover #onUserProfileDetailsHovered width="330">
  <ng-template kendoPopoverBodyTemplate>
    <common-user-profile-card [userId]="userId"></common-user-profile-card>
  </ng-template>
</kendo-popover>