<div class="flex-row mt-2">
  <div class="flex-col flex-space-bw align-items-center">
    <h5 class="title-md mb-0 text-capital">Friend or Family Contact</h5>
    <div>
    <span class="app-checkboxwidtext-wrapper">
      <input
        type="checkbox"
        kendoCheckBox
        aria-labelledby="ContactshowHistorical"
        id="ContactshowHistorical"
        [(ngModel)]="showHistoricalDataFlag"
        (change)="showHistoricalDataClick()"
      />
      <label class="k-checkbox-label" for="ContactshowHistorical"
        >Show historical</label
      >
    </span>
    </div>
  </div>
  <div class="flex-col mt-1">
    <div class="app-c-table">
      <kendo-grid [kendoGridBinding]="gridView" [rowClass]="rowClass">
        <kendo-grid-column field="firstName" title="Name" [width]="250">
        </kendo-grid-column>
        <kendo-grid-column
          field="relationshipSubTypeDesc"
          title="Relationship to client"
          [width]="150"
        >
        </kendo-grid-column>
        <kendo-grid-column
          field="phoneNbr"
          title="Phone Number"
          [width]="150"
        >
        <ng-template kendoGridCellTemplate let-dataItem>
          {{ dataItem.phoneNbr | phone }}
        </ng-template>
        </kendo-grid-column>
        <kendo-grid-column
          field="startDate"
          title="Effective Date"
          [width]="100"
        >
        <ng-template kendoGridCellTemplate let-dataItem>
          <span *ngIf="dataItem.activeFlag == 'Y' ;else endDateBlock">
            {{dataItem.startDate | date:'MM/dd/yyyy'}}
          </span>
          <ng-template #endDateBlock>
            {{dataItem.startDate | date:'MM/dd/yyyy'}} {{ (dataItem.endDate) ? ' - '+ (dataItem.endDate | date:'MM/dd/yyyy') : ''}}
          </ng-template>
        </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="by" title="By" [width]="50">
          <ng-template kendoGridCellTemplate let-dataItem>
            <button
              kendoButton
              [primary]="true"
              class="avatar-sm-btn c-default"
              kendoPopoverAnchor
              [popover]="onUserProfileDetailsHovered"
              showOn="hover"
              aria-label="profile avathar"
            >
            <common-user-photo-icon  [userId]="dataItem.creatorId"></common-user-photo-icon>
            </button>
            <kendo-popover
              #onUserProfileDetailsHovered
              width="330"
              position="left"
            >
              <ng-template kendoPopoverBodyTemplate>
                <common-user-profile-card [userId]="dataItem.creatorId"></common-user-profile-card>
              </ng-template>
            </kendo-popover>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column
          field="Option"
          title="Options"
          [width]="75"
          class="text-center"
        >
          <ng-template kendoGridCellTemplate let-dataItem>
            <kendo-dropdownbutton
              [data]="gridOptionData"
              icon="more-vertical"
              title="More option"
              class="TableActionPopup app-dropdown-action"
              buttonClass="k-icon-button"
              aria-label="more actions"
              [popupSettings]="{ popupClass: popupClassAction, animate: true }"
            >
              <ng-template class="app-dropdown-action-list" kendoDropDownButtonItemTemplate let-buttondataItem>
                <div *ngIf="dataItem.activeFlag ==='Y' ; else deleteButton">
                  <button kendoButton  look="flat" [attr.aria-label]="buttondataItem.text" [class]="buttondataItem.buttonType" aria-hidden="false" (click)="buttondataItem.click(dataItem)">
                    <span class="material-icons" [attr.aria-label]="buttondataItem.text" >{{buttondataItem.icon}}</span>
                    <label>   {{ buttondataItem.text }} </label>
                </button>
                </div>
                <ng-template #deleteButton>
                  <div *ngIf="buttondataItem.text === 'Delete Contact'">
                    <button kendoButton  look="flat" [attr.aria-label]="buttondataItem.text" [class]="buttondataItem.buttonType" aria-hidden="false" (click)="buttondataItem.click(dataItem)">
                      <span class="material-icons" [attr.aria-label]="buttondataItem.text" >{{buttondataItem.icon}}</span>
                      <label>   {{ buttondataItem.text }} </label>
                  </button>
                  </div>
                </ng-template>
              </ng-template>
            </kendo-dropdownbutton>
          </ng-template>
        </kendo-grid-column>
      </kendo-grid>
    </div>
  </div>
  <div class="flex-col mt-1">
    <button
      kendoButton
      [primary]="true"
      icon="add"
      (click)="onFriendOrFamilyDetailClicked(false)"
      aria-label="add friend or family"
    >
      Friend or family
    </button>
  </div>
</div>

<!-- Email Detail Popup-->
<kendo-dialog
  *ngIf="( showAddContactPopup$ |async)"
  (close)="onFriendOrFamilyDetailClosed()"
  class="app-c-modal app-c-modal-sm app-c-modal-np"
>
  <kendo-dialog-titlebar>{{
    isFriendsorFamilyEdit ? 'Edit Friend or family' : 'Add Friend or family'
  }}</kendo-dialog-titlebar>
  <case-management-friend-or-family-detail
  [selectedContact]="selectedContact"
  [isEditValue]="isEdit"
  [clientId]="clientId"
  [caseEligibilityId]="caseEligibilityId"
  (detailModalCloseEvent)="onFriendOrFamilyDetailCloseEvent($event)"
  [isFriendsorFamilyEditValue]="isFriendsorFamilyEdit"
  ></case-management-friend-or-family-detail>
</kendo-dialog>

<!-- Email Deactivate Popup-->
<kendo-dialog
  *ngIf="isDeactivateFriendOrFamilyOpened"
  (close)="onDeactivateFriendOrFamilyClosed()"
  class="app-c-modal app-c-modal-sm app-c-modal-np"
  title="Deactivate Contact"
>
  <case-management-deactivate-friend-or-family-confirmation [clientContact]="selectedContact" [clientId]="clientId" (deactivateModalCloseEvent)="closeDeactivateModal($event)"></case-management-deactivate-friend-or-family-confirmation>
</kendo-dialog>

<!-- Delete Contact Popup-->
<kendo-dialog
  *ngIf="isDeleteFriendOrFamilyOpened"
  (close)="onDeleteFriendOrFamilyClosed()"
  class="app-c-modal app-c-modal-sm app-c-modal-np"
  title="Delete Contact"
>
  <case-management-delete-friend-or-family-confirmation [clientContact]="selectedContact" [clientId]="clientId" (deleteModalCloseEvent)="closeDeleteModal($event)"></case-management-delete-friend-or-family-confirmation>
</kendo-dialog>
