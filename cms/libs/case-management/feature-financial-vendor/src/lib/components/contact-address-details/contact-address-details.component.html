<div [formGroup]="contactForm">


  <section class="k-dialog-body">
    <p class="text-muted mb-2">
      Select which mail code to add the contact(s) for. All fields are required unless otherwise stated.
    </p>

    <!-- Contacts -->
    <div class="flex-row mt-2">
      <div class="flex-col"  *ngIf="this.contactAddress.vendorContactId==null">
        <kendo-floatinglabel text="Mail Code">
          <kendo-dropdownlist [fillMode]="formUiStyle.dropDownFillMode" [data]="mailCodes" formControlName="mailcode"
            textField="mailCode" valueField="mailCode" [valuePrimitive]="true">
          </kendo-dropdownlist>
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="(!contactForm.controls['mailcode'].valid) &&isSubmitted">A mail code must be
          selected</kendo-formerror>
      </div>
      <ng-container formArrayName="vendorContacts">
        <ng-container *ngFor="let contact of AddContactForm.controls; let i=index">
          <ng-container [formGroupName]="i">
            <div class="flex-col d-flex align-iems-center justify-content-between" [formGroupName]="i" *ngIf="this.contactAddress.vendorContactId==null">
              <h4 class="mb-0">CONTACT {{i+1}} (OPTIONAL)</h4>
              <button kendoButton class="card-link-button no-ul text-bold k-danger-link" aria-label="delete contact"
                (click)="removeContact(i)">
                DELETE CONTACT
              </button>
            </div>
            <div class="flex-col">
              <kendo-floatinglabel text=" Name">
                <kendo-textbox aria-label="Contact Name" formControlName="contactName"
                  [fillMode]="formUiStyle.inputFillMode">
                </kendo-textbox>
              </kendo-floatinglabel>
              <kendo-formerror *ngIf="IsContactNameValid(i)&&isSubmitted">A Contact Name is
                required</kendo-formerror>
            </div>
            <div class="flex-col">
              <kendo-floatinglabel text="Description (Optional)">
                <kendo-textarea [fillMode]="formUiStyle.inputFillMode" formControlName="contactDesc"
                  resizable="vertical"></kendo-textarea>
              </kendo-floatinglabel>
            </div>
            <div class="flex-col">
              <kendo-floatinglabel text="Phone Number (optional)">             
                <kendo-maskedtextbox [maxlength]="10"  placeholder="Phone Number (optional)"  mask="(999) 000-0000" aria-label="Phone Number (optional)" [fillMode]="formUiStyle.inputFillMode"
          formControlName="phoneNbr">
      </kendo-maskedtextbox>
              </kendo-floatinglabel>
              <kendo-formerror *ngIf="isSubmitted && getContactControl(i, 'phoneNbr')?.errors?.['pattern']">
                Contact's Phone Number must have 10 digits
              </kendo-formerror>
            </div>
            <div class="flex-col mb-1">
              <kendo-floatinglabel text="Fax (optional)">
                <kendo-maskedtextbox [maxlength]="10" aria-label="Fax (optional)" placeholder="Fax (optional)" mask="(999) 000-0000" [fillMode]="formUiStyle.inputFillMode"
                formControlName="faxNbr">
            </kendo-maskedtextbox>
              </kendo-floatinglabel>
              <kendo-formerror *ngIf="isSubmitted && getContactControl(i, 'faxNbr')?.errors?.['pattern']">
                Contact's Fax must have 10 digits
              </kendo-formerror>
            </div>

            <div class="flex-col mb-1">
              <kendo-floatinglabel text="Email Address (optional)">
                <kendo-textbox aria-label="Email Address (optional)" formControlName="emailAddress"
                  [fillMode]="formUiStyle.inputFillMode">
                </kendo-textbox>
              </kendo-floatinglabel>
              <kendo-formerror *ngIf="isSubmitted && getContactControl(i, 'emailAddress')?.errors?.['pattern']">
                Not a valid email format
              </kendo-formerror>
            </div>
            <div class="flex-col mb-1  mt-checkbox">
              <div class="component-list-h">
                <span class="app-checkboxwidtext-wrapper" role="group">
                  <input
                    type="checkbox"
                    kendoCheckBox
                    aria-labelledby="AddressesshowHistorical"
                   value="Y" name="isPreferedContact" id="isPreferedContactno" 
                    (change)="OncheckboxClick($event,i)" formControlName="isPreferedContact"
                  />
                  <label class="k-checkbox-label" for="isPreferedContactYes">Prefered Contact </label 
                  >
                </span>
              
               
              </div>
            </div>
          </ng-container>
        </ng-container>
        <div class="flex-col"  *ngIf="this.contactAddress.vendorContactId==null">
          <button  kendoButton icon="add" [primary]="true" look="flat" aria-label="Add Contact" 
            (click)="onToggleAddNewContactClick()">
            Contact
          </button>
        </div>
      </ng-container>
    </div>
  </section>
  <kendo-dialog-actions>
    <div class="justify-content-between">
      <div class="justify-content-end">
        <button kendoButton [primary]="true" look="outline" aria-label="cancel adding phone detail"
          (click)="onCancel()">
          Cancel
        </button>

        <button kendoButton [primary]="true" aria-label="update or add phone detail" (click)="save()" *ngIf="this.contactAddress.vendorContactId==null" >
            Add
        </button>
        <button kendoButton [primary]="true" aria-label="update or add phone detail" (click)="Update()" *ngIf="this.contactAddress.vendorContactId!=null" >
          Edit
      </button>
      </div>
    </div>
  </kendo-dialog-actions>