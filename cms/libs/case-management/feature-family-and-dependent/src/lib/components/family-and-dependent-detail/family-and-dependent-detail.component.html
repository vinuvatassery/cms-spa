<div *ngIf="isExistDependent">
  <form [formGroup]="existFamilyMemberForm" (ngSubmit)="onExistDependentSubmit()">   
    <input type="hidden" formControlName="clientId">     
      <kendo-dialog-titlebar>
        {{ isAddFamilyMember ? 'Add Family Member' : 'Edit Family Member' }}
      </kendo-dialog-titlebar>
    <section class="k-dialog-body">
      <p class="text-muted mb-2">
        Search to see if the family member is already in the system. If they aren't in the system, manually add a new family member.
      </p>
      <div class="flex-row">
        <div class="flex-col">
          <div class="k-auto-complete-box">
            <span
              class="material-icons global-search-icon"
              aria-label="search member"
              aria-hidden="true"
              >search</span >
              <kendo-formerror *ngIf="existFamilyMemberForm?.hasError('required','clientId') && isExistSubmitted">Dependent
                is required</kendo-formerror>
            <kendo-autocomplete
              [fillMode]="formUiStyle.dropDownFillMode" 
              [data]="dependentSearch"           
              [value]="fullClientName"
              valueField ="fullCustomName"
              textField="clientId"
              placeholder="     Search Name, DOB or SSN"
              [popupSettings]="{ popupClass: popupClass, animate: true }"                 
              [filterable]="true"   
              (filterChange)="onsearchTextChange($event)"          
            >          
              <ng-template kendoAutoCompleteItemTemplate let-dataItem >               
                <span class="pr-1" (click)="onSearchTemplateClick(dataItem)">{{ dataItem.fullName}}</span>
                <span class="pr-1" (click)="onSearchTemplateClick(dataItem)">DOB {{ dataItem.dob }}</span>
                <span class="pr-1" (click)="onSearchTemplateClick(dataItem)">SSN {{ dataItem.ssn }}</span>            
              </ng-template>
              <ng-template kendoAutoCompleteFooterTemplate>
                <button
                  kendoButton
                  [primary]="true"
                  class="btn-full-no-radius"
                  (click)="onNewFamilyMemberClicked()"
                  aria-label="add new family member"
                >
                  ADD NEW FAMILY MEMBER
                </button>
              </ng-template>
            </kendo-autocomplete>        
          </div>
        </div>
        <div class="flex-col mb-1">
          <kendo-floatinglabel text="Relationship to Client">
            <kendo-dropdownlist  
            [fillMode]="formUiStyle.dropDownFillMode" 
            [data]="ddlRelationships$ | async"
            textField="lovDesc"
            valueField="lovCode" 
            [valuePrimitive]="true"
            formControlName="existRelationshipCode">
            </kendo-dropdownlist>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="existFamilyMemberForm?.hasError('required','existRelationshipCode') && isExistSubmitted">Relationship
            is required</kendo-formerror>
        </div>
      </div>
    </section>
    <kendo-dialog-actions>
      <div class="justify-content-between">
        <div>
          <button
            kendoButton
            class="k-danger-link"
            *ngIf="isOpenedEditFamilyMember && !isAddFamilyMember"
            aria-label="remove family member"
            (click)="onFormDeleteclick()"
          >
            Remove
          </button>
        </div>
        <div class="justify-content-end">
          <button
            kendoButton
            [primary]="false"
            look="outline"
            aria-label="cancel editing family member"
            (click)="onFamilyMemberClosed()"
          >
            Cancel
          </button>
          <button kendoButton [primary]="true" aria-label="add family member">
            Add
          </button>
        </div>
      </div>
    </kendo-dialog-actions>
</form>
</div>
<!-- Add Family Member Modal -->
<kendo-dialog
  *ngIf="isOpenedNewFamilyMember"
  (close)="onFamilyMemberClosed()"
  class="app-c-modal app-c-modal-sm app-c-modal-np"
>
<form [formGroup]="familyMemberForm" (ngSubmit)="onDependentSubmit()">
  <input type="hidden" formControlName="concurrencyStamp">
  <input type="hidden" formControlName="clientId">  
  <input type="hidden" formControlName="clientDependentId">  
  <input type="hidden" formControlName="dependentTypeCode">  
  <kendo-dialog-titlebar>  {{ isAddFamilyMember ? 'Add Family Member' : 'Edit Family Member' }} </kendo-dialog-titlebar>
  <section class="k-dialog-body">
    <p class="text-muted mb-2">Enter the family member’s information.</p>
    <div class="flex-row">
      <div class="flex-col">
        <kendo-floatinglabel text="Relationship to Client">
          <kendo-dropdownlist  [fillMode]="formUiStyle.dropDownFillMode" 
          [data]="ddlRelationships$ | async"
          formControlName="relationshipCode"
          textField="lovDesc" valueField="lovCode" [valuePrimitive]="true">
          </kendo-dropdownlist>
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="familyMemberForm?.hasError('required','relationshipCode') && isSubmitted">Relationship
          is required</kendo-formerror>
      </div>
      <div class="flex-col flex-col-6">
        <kendo-floatinglabel text="Legal First Name">
          <kendo-textbox    aria-label="Legal First Name" 
           [fillMode]="formUiStyle.inputFillMode"
           formControlName="firstName">   </kendo-textbox>
 
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="familyMemberForm?.hasError('required','firstName') && isSubmitted">First Name
          is required</kendo-formerror>
      </div>
      <div class="flex-col flex-col-6">
        <kendo-floatinglabel text="Legal Last Name">
          <kendo-textbox aria-label="legal last name"  
          [fillMode]="formUiStyle.inputFillMode"
          formControlName="lastName">   </kendo-textbox> 
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="familyMemberForm?.hasError('required','lastName') && isSubmitted">Last Name
          is required</kendo-formerror>
      </div>
      <div class="flex-col">
        <kendo-floatinglabel text="Date of Birth">
          <kendo-datepicker
          [fillMode]="formUiStyle.dateInputFillMode"
            format="MM-dd-yyyy"          
            formatPlaceholder="formatPattern"
            formControlName="dob"
          >
          </kendo-datepicker>
        </kendo-floatinglabel>
        <kendo-formerror *ngIf="familyMemberForm?.hasError('required','dob') && isSubmitted">Date of Birth
          is required</kendo-formerror>
      </div>
      <div class="flex-col">
        <kendo-floatinglabel text="Social Security Number (optional)">
          <kendo-textbox aria-label="social security number optional" 
           [fillMode]="formUiStyle.inputFillMode"
           formControlName="ssn"   
           >   </kendo-textbox> 
        </kendo-floatinglabel>
         <kendo-formerror *ngIf="familyMemberForm?.hasError('pattern','ssn') && isSubmitted">Enter a valid SSN</kendo-formerror>
      </div>
      <div class="flex-col mb-3">
        <h5>Currently enrolled in client’s health insurance plan?</h5>
        <div class="radio-column-list">
          <span class="app-radiobtnwidtext-wrapper">
            <input
              type="radio"
              #enrolledInHealthInsurancePlanYes
              kendoRadioButton
              name="enrolledInInsuranceFlag"             
              id="enrolledInHealthInsurancePlanYes"
              formControlName="enrolledInInsuranceFlag"
              value="Y"
            />
            <kendo-label
              class="k-radio-label"
              [for]="enrolledInHealthInsurancePlanYes"
              text="Yes"             
            ></kendo-label>
          </span>
          <span class="app-radiobtnwidtext-wrapper">
            <input
              type="radio"
              #enrolledInHealthInsurancePlanNo
              kendoRadioButton
              name="enrolledInInsuranceFlag"  
              formControlName="enrolledInInsuranceFlag"
              value="N"
            />
            <kendo-label
              class="k-radio-label"
              [for]="enrolledInHealthInsurancePlanNo"
              text="No"            >
          </kendo-label>
         
          </span>
          <kendo-formerror *ngIf="familyMemberForm?.hasError('required','enrolledInInsuranceFlag') && isSubmitted">enrollment status is required</kendo-formerror>
        </div>
      </div>
    </div>
  </section>

  <kendo-dialog-actions>
    <div class="justify-content-between">
      <div>
        <button
          kendoButton [primary]="false"
          class="k-danger-link"
          *ngIf="isOpenedEditFamilyMember && !isAddFamilyMember"
          aria-label="remove family member"
          (click)="onFormDeleteclick()"
        >
          DELETE
        </button>
      </div>
      <div class="justify-content-end">
        <button
          kendoButton         
          look="outline"
          aria-label="cancel adding family member"
          (click)="onFamilyMemberClosed()"
        >
          Cancel
        </button>
        <button kendoButton [primary]="true" aria-label="add family member">
          Add
        </button>
      </div>
    </div>
  </kendo-dialog-actions>
  </form>
</kendo-dialog>
