<!-- Income List -->
<div class="flex-row">
  <div class="flex-col">
    <div class="app-c-table" *ngIf="!hasNoIncome">
      <kendo-grid [data]="incomes$ | async"[pageSize]="state.take" [pageable]="true"
      [sortable]="true" [skip]="state.skip" [groupable]="false" [reorderable]="true" [resizable]="true"
      [columnMenu]="{ filter: true }" [sort]="state.sort" (dataStateChange)="dataStateChange($event)">
        <kendo-grid-column
          field="incomeSourceCodeDesc"
          title="Income Source"
          [width]="140"
        >
          <ng-template
            kendoGridFooterTemplate
            let-column
            let-columnIndex="columnIndex"
          >
            Total Monthly Income
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="incomeTypeCodeDesc" title="Income Type" [width]="130">
        </kendo-grid-column>
        <kendo-grid-column
          field="incomeAmt"
          title="Gross Amount"
          [width]="130"          
        >
        <ng-template kendoGridCellTemplate let-dataItem>
          <span class="tableamountview"> <strong>$</strong> {{dataItem.incomeAmt}}</span>
        </ng-template>
      </kendo-grid-column>
        <kendo-grid-column
          field="incomeFrequencyCodeDesc"
          title="Frequency"
          [width]="110"
        ></kendo-grid-column>
        <kendo-grid-column
          field="incomeStartDate"
          title="Date of Hire"
          [width]="110"
        >
        <ng-template kendoGridCellTemplate let-dataItem>
            {{dataItem.incomeStartDate| date: 'MM/dd/yyyy'}}
        </ng-template>
      </kendo-grid-column>
        <kendo-grid-column
          field="incomeEndDate"
          title="Income End"
          [width]="110"
        >
        <ng-template kendoGridCellTemplate let-dataItem>
          {{dataItem.incomeEndDate| date: 'MM/dd/yyyy'}}
      </ng-template>
      </kendo-grid-column>
        <kendo-grid-column
          field="ProofofIncome"
          title="Proof of Income"
          [width]="150"
          [sortable]="false"
        >
          <ng-template kendoGridCellTemplate let-dataItem>
            <div *ngIf="dataItem.noIncomeProofFlag != 'Y'">
              <button aria-label="client name" kendoButton look="flat" class="card-link-button" (click)="viewOrDownloadFile('view',dataItem.clientDocumentId,dataItem.documentName)">
              <a>{{dataItem.documentName}}</a>
            </button>

            </div>

          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column
          field="incomeNote"
          title="Financial Justification or Income note"
          [width]="150"
          [sticky]="true"
          [sortable]="false"
        >
          <ng-template
            kendoGridFooterTemplate
            let-column
            let-columnIndex="columnIndex"
          >
            ({{incomesTotal?.fplPercentage}}% FPL)
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column
          field="monthlyIncome"
          title="Monthly Income"
          [width]="100"
          format="{0:c2}"
          [sticky]="true"
        >
        <ng-template kendoGridCellTemplate let-dataItem>
          <span class="tableamountview"> <strong>$</strong> {{dataItem.monthlyIncome | kendoNumber: 'n2'}}</span>
        </ng-template>
          <ng-template
            kendoGridFooterTemplate
            let-column
            let-columnIndex="columnIndex"  >
          <span class="tableamountview"> <strong>$</strong> {{incomesTotal?.totalIncome | kendoNumber: 'n2'}} </span>
          </ng-template>

        </kendo-grid-column>
        <kendo-grid-column
          field="Option"
          title="Option"
          [width]="75"
          [sticky]="true"
          class="text-center"
          [filterable]="columnOptionDisabled" [columnMenu]="columnOptionDisabled" [sortable]="columnOptionDisabled"
        >
          <ng-template kendoGridCellTemplate let-dataItem>
            <kendo-dropdownbutton
              [data]="actionsmore"
              icon="more-vertical"
              title="More option"
              class="TableActionPopup"
              buttonClass="k-icon-button"
              aria-label="more actions"
              [popupSettings]="{ popupClass: popupClassAction, animate: true }"
            >

              <ng-template class="app-dropdown-action-list" kendoDropDownButtonItemTemplate let-buttondataItem>
                <button kendoButton  look="flat" [attr.aria-label]="buttondataItem.text" [class]="buttondataItem.buttonType" aria-hidden="false" (click)="onIncomeActionClicked(dataItem,buttondataItem.type)">
                  <span class="material-icons" [attr.aria-label]="buttondataItem.text" >{{buttondataItem.icon}}</span>
                  <label>   {{ buttondataItem.text }} </label>
              </button>

              </ng-template>
            </kendo-dropdownbutton>
          </ng-template>
        </kendo-grid-column>
         <!-- grid Pagination template -->
         <ng-template kendoPagerTemplate let-totalPages="totalPages" let-pagerFirstPage="pagerFirstPage"
         let-currentPage="currentPage"  >
         <div class="grid-custom-paginationtemplates d-flex">
           <div class="d-flex align-items-center">
             <label class="mr-1" for="RowsPerPage">Rows Per Page</label>
             <kendo-dropdownlist [fillMode]="formUiStyle.dropDownFillMode" [data]="pageSizes" [textField]="'text'"
               [valueField]="'value'" #RowsPerPage id="RowsPerPage" aria-label ="Rows Per Page" [valuePrimitive]="true" [(value)]="state.take"
               (selectionChange)="pageselectionchange($event)"></kendo-dropdownlist>
             <kendo-pager-info> </kendo-pager-info>
             <kendo-grid-messages [pagerItems]="' '" [pagerPage]="'Page'"> </kendo-grid-messages>
           </div>
           <div class="d-flex">
             <kendo-pager-input></kendo-pager-input>
             <kendo-pager-prev-buttons></kendo-pager-prev-buttons>
             <kendo-pager-next-buttons></kendo-pager-next-buttons>
           </div>
         </div>
       </ng-template>
       <!-- grid loader template -->
       <ng-template kendoGridLoadingTemplate>
         <common-grid-loader-component></common-grid-loader-component>
       </ng-template>
      </kendo-grid>
    </div>
    <div
      class="block-section mt-1 text-right"
      *ngIf="!isAddIncomeButtonAndFooterNoteDisplay"
    >
      FPL changed from 155% to 150% on 03/01/2020
    </div>
    <div class="flex-row" *ngIf="!hasNoIncome">
      <div class="flex-col mt-1">
        <button
          kendoButton
          *ngIf="isAddIncomeButtonAndFooterNoteDisplay"
          [primary]="true"
          icon="add"
          (click)="onIncomeClicked(false)"
          aria-label="add income"
        >
          Income
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Dependents' Proof of School -->
<div class="flex-row mt-3">
  <div class="flex-col">
    <h5 class="text-capital align-items-center">Dependents' Proof of School</h5>
    <div class="app-c-table">
      <kendo-grid [data]="dependentsProofofSchools$">
        <kendo-grid-column field="name" title="Name" [width]="130">
        </kendo-grid-column>
        <kendo-grid-column field="age" title="Age" [width]="130">
        </kendo-grid-column>
        <kendo-grid-column
          field="relationship"
          title="Relationship"
          [width]="130"
        ></kendo-grid-column>
        <kendo-grid-column
          field="ProofofSchool"
          title="Proof of School"
          [width]="130"
          class="text-center"
          [filterable]="columnOptionDisabled" [columnMenu]="columnOptionDisabled" [sortable]="columnOptionDisabled"
        >
        <ng-template kendoGridCellTemplate let-dataItem>
          <div class="d-flex">
              <span class="app-c-badge" *ngIf="dataItem.uploaingProofDoc"><span
              class="k-icon k-i-loading k-input-loading-icon input-inline-loader"></span><span> </span>
           </span>
          <kendo-dropdownbutton  [data]="actions"   icon="upload"   class="TableActionPopup app-dropdown-action"   buttonClass="k-icon-button"
            aria-label="more actions"  [popupSettings]="{ popupClass: popupClassAction, animate: true }"  > 
         
            <ng-template class="app-dropdown-action-list" kendoDropDownButtonItemTemplate let-buttondataItem>  <!-- <button kendoButton look="flat" *ngIf="buttondataItem.text === 'Attach from computer'" [attr.aria-label]="buttondataItem.text"
            class="upoadlistbtn" [class]="buttondataItem.buttonType" aria-hidden="false"> 
            <label [for]="proofOfSchoolUploaded"> {{ buttondataItem.text }} </label>
          </button> --> 

          <button   kendoButton *ngIf="buttondataItem.id === 'attachfromclient' || (buttondataItem.id === 'removefile' && (dataItem.clientDocumentId !== null && dataItem.clientDocumentId !== ' ')) "   class="upoadlistbtn" look="flat" [attr.aria-label]="buttondataItem.text" [class]="buttondataItem.buttonType" aria-hidden="false" (click)="buttondataItem.click($event,dataItem)" >
            <!-- <span class="material-icons" [attr.aria-label]="dataItem.text" >{{dataItem.icon}}</span> -->
            <label  [for]="buttondataItem.id" *ngIf="buttondataItem.id === 'attachfromclient'">{{ (dataItem.clientDocumentId !== null && dataItem.clientDocumentId !== ' ') ? "Reattach from client\'s attachments" : "Attach from client\'s attachments" }}  </label>
            <label  [for]="buttondataItem.id" *ngIf="buttondataItem.id === 'removefile'">{{ buttondataItem.text }}  </label>
        </button>
          <button  kendoButton  *ngIf="buttondataItem.id === 'proofOfSchoolUploaded' "  class="upoadlistbtn" look="flat" [attr.aria-label]="buttondataItem.text" [class]="buttondataItem.buttonType" aria-hidden="false" (click)="buttondataItem.click($event,dataItem)" >
            <!-- <span class="material-icons" [attr.aria-label]="dataItem.text" >{{dataItem.icon}}</span> -->
            <label  [for]="proofOfSchoolUploaded"> {{ (dataItem.clientDocumentId !== null && dataItem.clientDocumentId !== ' ') ? 'Reattach from computer' : 'Attach from computer ' }} </label>
        </button>
          </ng-template>

          </kendo-dropdownbutton>
          <button aria-label="doc name" *ngIf="dataItem.clientDocumentId !== null && dataItem.clientDocumentId!==' '" kendoButton look="flat" class="card-link-button" (click)="viewOrDownloadFile('view',dataItem.clientDocumentId,dataItem.documentName)">
            <a>{{dataItem.documentName}}</a>
          </button>
        

          <kendo-upload hidden  aria-label="upload proof" name="upload proof"
          [restrictions]="uploadFileRestrictions.fileRestrictions"   [multiple]="false" [autoUpload]="false" (select)="handleFileSelected($event,dataItem)"
          #proofOfSchoolUploaded [ngModel]="proofOfSchoolDocument" [ngModelOptions]="{standalone: true}">
          </kendo-upload>
        </div>
        </ng-template>
        </kendo-grid-column>
      </kendo-grid>
    </div>
  </div>
</div>

<!-- Add Income  Modal -->
<kendo-dialog *ngIf="isOpenedIncome" (close)="onIncomeClosed()" class="app-c-modal app-c-modal-md app-c-modal-np">
  <kendo-dialog-titlebar>{{
    isEdit ? 'Edit Income' : 'Add Income'
  }}</kendo-dialog-titlebar>
  <case-management-income-detail  (closePopup)="closeIncomePopup($event)"[isEditValue]="isEdit" [clientCaseEligibilityId]="clientCaseEligibilityId" [clientId]="clientId" [clientCaseId]="clientCaseId" [selectedIncome]="selectedIncome" (sendDetailToIncomeList)="incomeDetailResponseHandle($event)"> </case-management-income-detail>
</kendo-dialog>


<kendo-dialog *ngIf="isRemoveIncomeConfirmationPopupOpened"  (close)="onRemoveIncomeConfirmationClosed()"
  class="app-c-modal app-c-modal-sm app-c-modal-np" title="Delete Income">
  <case-management-remove-income-confirmation
  (closeModal)="onRemoveIncomeConfirmationClosed()"
  [selectedIncome]="selectedIncome"
  (sendDetailToIncomeList)="incomeDetailResponseHandle($event)"></case-management-remove-income-confirmation>


</kendo-dialog>

