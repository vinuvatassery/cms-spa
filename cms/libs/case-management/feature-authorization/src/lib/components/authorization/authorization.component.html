<div class="client-data-block">
  <h2 hidden>Application</h2>
  <h3>Authorization</h3>
  <h4 hidden>Authorization Notice</h4>

  <section class="pt-1">
    <p> 
     {{isCerForm?  'Send the CER to the client to sign. They may also sign through their online portal.':'Send the application to the applicant to sign. They may also sign through  their online portal.'}}
    </p>
    <div class="flex-row">
      <div class="flex-col mt-2 mb-2">
        <button
          kendoButton
          class="k-primary-link text-t-normal text-underline"
          (click)="onAuthorizationNoticeClicked()"
          aria-label="view authorization notice"
        >
          View Authorization Notice
        </button>
      </div>
    </div>
    <div class="flex-row">
      <div class="flex-col flex-col-6">
        <kendo-floatinglabel text="Date Applicant Signed">
          <kendo-datepicker
          [fillMode]="formUiStyle.dateInputFillMode"
            format="MM-dd-yyyy"
            [(ngModel)]="currentDate"
            formatPlaceholder="formatPattern"
            (valueChange)="onChange($event)"
          >
          </kendo-datepicker>
          <kendo-formerror *ngIf="cerDateValidator && currentDate != null">Date Applicant Signed cannot be greater than Current Date.</kendo-formerror>
          <!-- <kendo-formerror>Date Applicant Signed is
            required.</kendo-formerror> -->
        </kendo-floatinglabel>
      </div>
      <div class="flex-col flex-col-6">
        <kendo-floatinglabel text="Date Signature Noted">
          <kendo-textbox
          aria-label="Date Signature Noted" 
          [(ngModel)]="dateSignature" 
          [disabled]="true" 
          [fillMode]="formUiStyle.dateInputFillMode" 
          formatPlaceholder="formatPattern"
          format="MM-dd-yyyy">   
        </kendo-textbox>
        </kendo-floatinglabel>
      </div>
      <!-- Hide after sent letter or email -->
      <div class="flex-col mt-1">
        <button
          kendoButton
          [primary]="true"
          (click)="onSendNewLetterClicked()"
          aria-label="send letter"
        >
          Send Letter
        </button>
        <button *ngIf="isGoPaperlessOpted" [disabled]="dateSignature != null" 
          kendoButton
          [primary]="true"
          class="ml-2"
          (click)="!cerDateValidator ? onSendNewEmailClicked() : null"
          aria-label="send email"
        >
          Send Email
        </button>
      </div>
      <!-- Show after sent letter -->
      <div class="flex-col" *ngIf="isPrintClicked">
        <div class="flex-row">
          <div class="flex-col align-items-center">
            <span
              >Letter sent 01-01-2022 by
              <a
                kendoPopoverAnchor
                [popover]="onUserProfileCardHovered"
                showOn="hover"
                >Sara John</a
              ></span
            >
            <button
              kendoButton
              [primary]="true"
              look="flat"
              class="ml-1"
              (click)="onSendNewLetterClicked()"
              aria-label="re send letter"
            >
              Re-Send Letter
            </button>
            <button
              kendoButton
              [primary]="true"
              look="flat"
              class="ml-1"
              (click)="onSendNewEmailClicked()"
              aria-label="send email"
            >
              Send Email
            </button>
          </div>
        </div>
      </div>

<!-- Copy of signed application -->
      <div class="flex-col mt-2" *ngIf="dateSignature != null">
        <h5>COPY OF SIGNED APPLICATION</h5>
      </div>
      <div class="flex-col flex-col-6" *ngIf="dateSignature != null">
        <kendo-upload (select)="handleFileSelected($event)" [ngModel]="copyOfSignedApplication">
          <ng-template kendoUploadFileInfoTemplate let-files let-state="state">
            <span >
              <span>{{ files[0].name }} </span> 
              <br>
              <span>{{   files[0].size | fileSize }}</span> 
            </span>
          </ng-template>
        </kendo-upload>
        <kendo-formhint>Max file size 25MB</kendo-formhint>
        <kendo-formerror *ngIf="showCopyOfSignedApplicationRequiredValidation"> Copy Of Signed Application is required
        </kendo-formerror>
        <kendo-formerror *ngIf="copyOfSignedApplicationSizeValidation">File size is limited to 25 MB. Please select a smaller file. </kendo-formerror>
      </div>

      <!-- Show after send email -->
      <div class="flex-col" *ngIf="isSendEmailClicked">
        <div class="flex-row">
          <div class="flex-col align-items-center">
            <span
              >Email sent 01-01-2022 by
              <a
                kendoPopoverAnchor
                [popover]="onUserProfileCardHovered"
                showOn="hover"
                >Sara John</a
              ></span
            >
            <button
              kendoButton
              [primary]="true"
              look="flat"
              class="ml-1"
              (click)="onSendNewEmailClicked()"
              aria-label="re send email"
            >
              Re-Send Email
            </button>
            <button
              kendoButton
              [primary]="true"
              look="flat"
              class="ml-1"
              (click)="onSendNewLetterClicked()"
              aria-label="send letter"
            >
              Send Letter
            </button>
          </div>
          <div class="flex-col mt-2">
            <h5>COPY OF SIGNED APPLICATION</h5>
          </div>
          <div class="flex-col flex-col-6">
            <kendo-upload></kendo-upload>
            <kendo-formhint>Max file size 25MB</kendo-formhint>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Authorization Notice Modal HTML -->
<kendo-dialog
  *ngIf="isAuthorizationNoticePopupOpened"
  (close)="onCloseAuthorizationNoticeClicked()"
  class="app-c-modal app-c-modal-lg app-c-modal-np"
  title="Authorization Notice"
  kendoTooltip
>
  <case-management-authorization-notice></case-management-authorization-notice>
</kendo-dialog>

<!-- Send New Letter Modal -->
<case-management-send-letter
  *ngIf="isSendNewLetterPopupOpened"
  [data]="screenName"
  (closeSendLetterEvent)="handleCloseSendNewLetterClicked($event)"
  kendoTooltip
>
</case-management-send-letter>

<!-- Send New Email Modal -->
<case-management-send-email
  *ngIf="isSendNewEmailPopupOpened"
  [data]="screenName"
  (closeSendEmailEvent)="handleCloseSendNewEmailClicked($event)"
  kendoTooltip
></case-management-send-email>
<!-- User Profile Card -->
<kendo-popover #onUserProfileCardHovered width="330">
  <ng-template kendoPopoverBodyTemplate>
    <common-user-profile-card></common-user-profile-card>
  </ng-template>
</kendo-popover>