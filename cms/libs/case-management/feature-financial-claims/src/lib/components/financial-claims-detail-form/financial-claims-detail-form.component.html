<kendo-dialog-titlebar (close)="closeAddEditClaimsFormModalClicked()">
    <section class="app-l-mainTittle">
        <h1 class="maintitle_withicon text-bold">{{title}} Claims</h1>
    </section>
</kendo-dialog-titlebar>
<section class="add_main_popup_screen">
    <div [formGroup]="claimForm">

        <div class="add_new_top_section">
            <p class="mb-3"> Select a {{claimsType | titlecase}} Provider to bulk add services for this claim.</p>
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <div class="combotable_search_list new_refund_Search new_claims_Search mb-3">
                        <span class="material-icons global-search-icon" aria-label="search"
                            aria-hidden="true">search</span>
                        <span *ngIf="medicalProvidersearchLoaderVisibility$ | async"
                            class=" k-icon k-i-loading k-input-loading-icon input-inline-loader">
                        </span>

                        <kendo-multicolumncombobox textField="providerFullName" valueField="vendorAddressId"
                            [fillMode]="formUiStyle.dropDownFillMode"
                            placeholder="Search {{claimsType | titlecase}} Providers by name or TIN"
                            [popupSettings]="{popupClass: 'combotable_search_list', animate: true }" [filterable]="true"
                            formControlName="medicalProvider" (filterChange)="searchMedicalProvider($event)"
                            [data]="pharmacySearchResult$ | async" [(ngModel)]="selectedMedicalProvider"
                            (valueChange)="onProviderValueChange($event)">
                            <button kendoButton fillMode="clear" icon="image"></button>

                            <kendo-combobox-column>
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span>{{ dataItem.vendorName }}</span>
                                </ng-template>
                            </kendo-combobox-column>

                            <kendo-combobox-column>
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class="text-muted"><em> TIN:</em> {{ dataItem.tin }}</span>
                                </ng-template>
                            </kendo-combobox-column>

                            <kendo-combobox-column>
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class="text-muted"><em> Mail Code:</em> {{ dataItem.mailCode }}</span>
                                </ng-template>
                            </kendo-combobox-column>

                        </kendo-multicolumncombobox>
                        <kendo-formerror *ngIf="(!claimForm.controls['medicalProvider'].valid) && isSubmitted"
                            class="d-flex align-items-center"> <span class="material-icons mr-1"
                                aria-hidden="false">info</span> Provider is required</kendo-formerror>

                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <div class="combotable_search_list new_refund_Search new_claims_Search">
                        <span class="material-icons global-search-icon" aria-label="search"
                            aria-hidden="true">search</span>
                        <span *ngIf="clientSearchLoaderVisibility$ | async"
                            class=" k-icon k-i-loading k-input-loading-icon input-inline-loader">
                        </span>
                        <kendo-multicolumncombobox [data]="clientSearchResult$ | async" textField="clientFullName"
                            valueField="clientId" [fillMode]="formUiStyle.dropDownFillMode"
                            placeholder="Search Client Name, ID, or SSN"
                            [popupSettings]="{popupClass: 'combotable_search_list', animate: true }" [filterable]="true"
                            formControlName="client" (filterChange)="loadClientBySearchText($event)"
                            (valueChange)="onClientValueChange($event)" [(ngModel)]="selectedClient">
                            <button kendoButton fillMode="clear" icon="image"></button>

                            <kendo-combobox-column>
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span>{{ dataItem.clientFullName }}</span>
                                </ng-template>
                            </kendo-combobox-column>
                            <kendo-combobox-column [width]="100">
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class=" text-muted"> <em>ID:</em> {{dataItem.clientId}}</span>
                                </ng-template>
                            </kendo-combobox-column>
                            <kendo-combobox-column [width]="150">
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class="text-muted"><em> SSN:</em> {{ dataItem.ssn }}</span>
                                </ng-template>
                            </kendo-combobox-column>
                            <kendo-combobox-column [width]="125">
                                <ng-template kendoMultiColumnComboBoxColumnCellTemplate let-dataItem>
                                    <span class=" text-muted"> <em>DOB:</em> {{ dataItem.dob | date: 'MM/dd/yyyy'}}</span>
                                </ng-template>
                            </kendo-combobox-column>
                        </kendo-multicolumncombobox>
                        <kendo-formerror *ngIf="(!claimForm.controls['client'].valid) && isSubmitted"
                            class="d-flex align-items-center">
                            <span class="material-icons mr-1" aria-hidden="false">info</span>
                            Client is required
                        </kendo-formerror>
                    </div>
                </div>
            </div>
            <div class="flex-row">
                <div class="flex-col flex-col-6">
                    <kendo-floatinglabel text="Invoice ID">
                        <kendo-textbox aria-label="Invoice ID" [fillMode]="formUiStyle.inputFillMode"
                            formControlName="invoiceId">
                        </kendo-textbox>
                    </kendo-floatinglabel>
                    <kendo-formerror *ngIf="(!claimForm.controls['invoiceId'].valid) && isSubmitted"
                        class="d-flex align-items-center"> <span class="material-icons mr-1"
                            aria-hidden="false">info</span>
                        Invoice ID is required
                    </kendo-formerror>
                </div>
            </div>

        </div>

        <div class="add_new_bottom_section">

            <div class="flex-row">
                <div class="flex-col flex-col-6">
                   
                        <ng-container formArrayName="claimService">
                            <ng-container *ngFor="let contact of addClaimServicesForm.controls; let i=index">
                                <ng-container [formGroupName]="i">
                                    <div class=" mb-3">
                                    <div class="flex-space-bw align-items-center">
                                        <h4 class="mar-0">SERVICE {{i+1}}</h4>
                                        <button class="" kendoButton fillMode="flat" themeColor="error"
                                            (click)="removeService(i)">DELETE</button>
                                    </div>
                                    <div class="flex-row">
                                        <div class="flex-col flex-col-6">
                                            <kendo-floatinglabel text="Service Start Date">
                                                <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode"
                                                    aria-label="Service Start Date" format="MM/dd/yyyy"
                                                    formatPlaceholder="formatPattern" formControlName="serviceStartDate"
                                                    (valueChange)="onDateChange(i)">
                                                </kendo-datepicker>
                                            </kendo-floatinglabel>
                                            <kendo-formerror
                                                *ngIf="(isControlValid('serviceStartDate', i) && isSubmitted)"
                                                class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                    aria-hidden="false">info</span>Service Start Date is required
                                            </kendo-formerror>
                                        </div>
                                        <div class="flex-col flex-col-6">
                                            <kendo-floatinglabel text="Service End Date">
                                                <kendo-datepicker [fillMode]="formUiStyle.dateInputFillMode"
                                                    aria-label="Service End Date" format="MM/dd/yyyy"
                                                    formatPlaceholder="formatPattern" formControlName="serviceEndDate"
                                                    (valueChange)="onDateChange(i)">
                                                </kendo-datepicker>
                                            </kendo-floatinglabel>
                                            <kendo-formerror
                                                *ngIf="(isControlValid('serviceEndDate', i) && isSubmitted)"
                                                class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                    aria-hidden="false">info</span>Service End Date is required
                                            </kendo-formerror>
                                        </div>
                                        <div class="ml-2">
                                            <kendo-formerror *ngIf="false" class="d-flex align-items-center">
                                                <span class="material-icons mr-1" aria-hidden="false">info</span>
                                                Invoice is over 1 year old. <a kendoButton
                                                    class="ml-1 card-link-button">Make
                                                    Exception</a></kendo-formerror>
                                        </div>
                                    </div>
                                    <div class="flex-row">
                                        <div class="flex-col flex-col-4">
                                            <kendo-floatinglabel text="Payment Type">
                                                <kendo-dropdownlist formControlName="paymentType" aria-label="Type"
                                                    [fillMode]="formUiStyle.dropDownFillMode"
                                                    [data]="paymentRequestType$ | async" valueField="lovCode"
                                                    textField="lovDesc" [valuePrimitive]="true"
                                                    [loading]="(paymentRequestType$ | async)?.length===0"
                                                    (valueChange)="onPaymentTypeValueChange($event, i)">

                                                </kendo-dropdownlist>
                                            </kendo-floatinglabel>
                                            <kendo-formerror *ngIf="(isControlValid('paymentType', i) && isSubmitted)"
                                                class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                    aria-hidden="false">info</span>Payment Type is required
                                            </kendo-formerror>
                                        </div>
                                        <div class="flex-col flex-col-4">
                                            <kendo-floatinglabel text="CPT Code" class="inline-search-loader">
                                                <span *ngIf="CPTCodeSearchLoaderVisibility$ | async"
                                                    class=" k-icon k-i-loading k-input-loading-icon input-inline-loader"></span>
                                                <kendo-autocomplete [fillMode]="formUiStyle.dropDownFillMode"
                                                    [data]="searchCTPCode$ | async" formControlName="cptCode"
                                                    valueField="cptCode1" [filterable]="true" [value]="selectedCPTCode"
                                                    (filterChange)="searchcptcode($event)"
                                                    [popupSettings]="{ popupClass: 'auto-complete-with-template', animate: true }">
                                                    <ng-template kendoAutoCompleteItemTemplate let-dataItem>
                                                        <span class="pr-1" (click)="onCPTCodeValueChange(dataItem,i)">{{
                                                            dataItem.cptCode1}}</span>
                                                    </ng-template>
                                                </kendo-autocomplete>
                                                <kendo-formerror *ngIf="(isControlValid('cptCode', i) && isSubmitted)"
                                                    class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                        aria-hidden="false">info</span>CTP Code is
                                                    required
                                                </kendo-formerror>
                                            </kendo-floatinglabel>
                                        </div>
                                        <div class="flex-col flex-col-4">
                                            <kendo-floatinglabel text="PCA Code">
                                                <kendo-textbox aria-label="PCA Code"
                                                    [fillMode]="formUiStyle.inputFillMode" formControlName="pcaCode">
                                                </kendo-textbox>
                                            </kendo-floatinglabel>
                                        </div>
                                    </div>
                                    <div class="flex-row">
                                        <div class="flex-col">
                                            <kendo-floatinglabel text="Service Description">
                                                <kendo-textarea [fillMode]="formUiStyle.inputFillMode" resizable="auto"
                                                    aria-label="Service Description"
                                                    formControlName="serviceDescription" [maxlength]="textMaxLength">
                                                    <kendo-textarea-suffix class="justify-content-end">
                                                        <span class="tareacounter"> {{serviceDescCharCount(i)}}</span>
                                                    </kendo-textarea-suffix>
                                                </kendo-textarea>
                                            </kendo-floatinglabel>
                                            <kendo-formerror
                                                *ngIf="(isControlValid('serviceDescription',i) && isSubmitted)"
                                                class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                    aria-hidden="false">info</span>Service Description is required
                                            </kendo-formerror>
                                        </div>
                                    </div>
                                    <div class="flex-row">
                                        <div class="flex-col flex-col-6">

                                            <kendo-floatinglabel text="Service Cost" class="amount-with-symbol">
                                                <span class="k-input-prefix custom-currencysymbol"> $ </span>
                                                <kendo-numerictextbox aria-label="Service Cost"  [spinners]="false"
                                                    [fillMode]="formUiStyle.inputFillMode" format="#.000"
                                                    formControlName="serviceCost">
                                                </kendo-numerictextbox>
                                            </kendo-floatinglabel>
                                            <kendo-formerror *ngIf="(isControlValid('serviceCost',i) && isSubmitted)"
                                                class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                    aria-hidden="false">info</span>Service Cost is required
                                            </kendo-formerror>
                                        </div>
                                        <div class="flex-col flex-col-6">
                                            <kendo-floatinglabel text="Amount Due" class="amount-with-symbol">
                                                <span class="k-input-prefix custom-currencysymbol"> $ </span>
                                                <kendo-numerictextbox aria-label="Amount Due"  [spinners]="false"
                                                    [fillMode]="formUiStyle.inputFillMode" formControlName="amountDue"
                                                    format="#.000">
                                                </kendo-numerictextbox>
                                            </kendo-floatinglabel>
                                            <kendo-formerror *ngIf="(isControlValid('amountDue',i) && isSubmitted)"
                                                class="d-flex align-items-center"> <span class="material-icons mr-1"
                                                    aria-hidden="false">info</span>Amount Due is required
                                            </kendo-formerror>
                                        </div>
                                        <div class="ml-2">
                                            <kendo-formerror *ngIf="false" class="align-items-center">
                                                <span class="material-icons mr-1" aria-hidden="false">info</span> Client
                                                exceeded maximum
                                                benefits. <a kendoButton class="ml-1 card-link-button">Make
                                                    Exception</a></kendo-formerror>
                                        </div>
                                    </div>
                                    <div class="flex-row">
                                        <div class="flex-col">
                                            <kendo-floatinglabel text="Reason For Exception">
                                                <kendo-textarea [fillMode]="formUiStyle.inputFillMode" resizable="auto"
                                                    aria-label="Reason For Exception" [maxlength]="textMaxLength"
                                                    formControlName="reasonForException">
                                                    <kendo-textarea-suffix class="justify-content-end">
                                                        <span class="tareacounter"> {{reasonCharCount(i)}}</span>
                                                    </kendo-textarea-suffix>
                                                </kendo-textarea>
                                            </kendo-floatinglabel>
                                        </div>
                                    </div>
                                </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                   
                </div>
            </div>
            <hr class="row-border" />
            <div class="mt-2">
                <button class="" kendoButton fillMode="flat" themeColor="primary" (click)="addClaimServiceGroup()">
                    <span class="material-icons" aria-label="New Claims" aria-hidden="false">add</span>
                    New Service</button>
            </div>
            <div>
                <span class="app-checkboxwidtext-wrapper">
                    <input type="checkbox" kendoCheckBox aria-labelledby="applyChangesToMailingAddress"
                        id="isSpotsPaymentInput" [checked]="isSpotsPayment" (change)="onSpotsPaymentChange($event)" />
                    <label class="k-checkbox-label" for="isSpotsPaymentInput">
                        <strong>This is a SPOTS payment</strong></label>
                </span>
            </div>

        </div>

    </div>
</section>
<div class="add_new_fixed_bottom">
    <div *ngIf="isRecentClaimShow">
        <h5>Recent Claims for this {{clientName}} and {{vendorName}}</h5>
        <div class="add_new_fixed_bottom_grid_section">
            <cms-financial-claims-recent-claims-list [vendorId]="vendorId" [clientId]="clientId"
                [claimsType]="claimsType"></cms-financial-claims-recent-claims-list>
        </div>
    </div>
    <div class="d-flex align-items-center mt-1">
        <button kendoButton [primary]="true" aria-label="Confirm Selections" class="" (click)="save()">
            {{addOrEdit}}
        </button>
        <button kendoButton [primary]="true" look="outline" class="ml-2" aria-label="Cancel"
            (click)="closeAddEditClaimsFormModalClicked()"> Cancel </button>
        <span class="ml-2">1 service(s) to be added</span>
    </div>
</div>