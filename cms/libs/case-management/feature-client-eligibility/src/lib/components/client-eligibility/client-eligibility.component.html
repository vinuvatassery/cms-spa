<section class="app-l-mainTittle case-reviewsection" kendoTooltip [formGroup]="eligibilityForm">
  <h2>Application Review - {{eligibility?.firstName}} {{eligibility?.lastName}}</h2>
  <p class="mt-1 mb-3">
    Please indicate whether the applicant meets the eligibility criteria below.
    If approved, specify Status, Group, Eligibility Period, and initiate the
    approval notice. If rejected, specify Status and initiate the rejection
    notice.
  </p>
  <div class="app-c-card app-c-card--border-box mb-2" *ngFor="let question of questions; let i = index">
    <div class="flex-row">
      <div class="flex-col flex-col-8">
        <h4 class="mb-1 mt-0">{{question.questionDesc}}</h4>
        <span class="card-buttons-wrap mb-1" *ngIf="question.questionCode===reviewQuestionCode.income">
          <span class="pr-3"><span class="text-bold">Family Size:</span> {{eligibility?.familySize}}</span>
          <span class="pr-3"><span class="text-bold">Monthly Income:</span> ${{eligibility?.totalIncome}}</span>
          <span class="pr-3"><span class="text-bold">FPL:</span> {{eligibility?.fpl}}%</span>
        </span>
        <span class="card-buttons-wrap" *ngFor="let doc of getQuestionDocuments(question.questionCode);">
          <button kendoButton look="flat" aria-label="download file" class="k-icon-button" title="Download"
            (click)="clientDocumentFacade.viewOrDownloadFile('download',doc.clientDocumentId,doc.documentName)">
            <span class="material-icons" aria-label="download file" aria-hidden="true">file_download</span>
          </button>
          <button kendoButton look="flat" aria-label="open in new tab" class="k-icon-button" title="Open in new tab"
            (click)="clientDocumentFacade.viewOrDownloadFile('view',doc.clientDocumentId,doc.documentName)">
            <span class="material-icons" aria-label="open in new tab" aria-hidden="true">open_in_new</span>
          </button>
          <a class="text-bold text-underline">{{doc.documentName}}</a>
          <span class="text-muted">({{doc.documentSize | fileSize}})</span>
        </span>
        <kendo-formerror *ngIf="formSubmited && !question.responseAnswerId">{{question.questionDesc}} response is
          required.</kendo-formerror>
      </div>
      <div class="flex-col flex-col-4 text-right">

        <kendo-buttongroup selection="single">
          <button *ngFor="let ans of question.answers" (click)="answerClick(question,ans)" kendoButton
            aria-label="proof of address yes" [toggleable]="true"
            [selected]="ans.reviewQuestionAnswerId===question.responseAnswerId">
            {{ans.answerDesc}}
          </button>
        </kendo-buttongroup>
      </div>

    </div>
    <div *ngIf="question.answerCode === 'NO'">
      <div class="flex-row pl-3 mt-2" *ngFor="let child of question.childQuestions">
        <div class="flex-col flex-col-8">
          <h4 class="mb-1 mt-0">{{child.questionDesc}}</h4>
        </div>
        <div class="flex-col flex-col-4 text-right">
          <kendo-buttongroup selection="single">
            <button *ngFor="let ans of child.answers" (click)="answerClick(child,ans)" kendoButton
              aria-label="proof of address yes" [toggleable]="true"
              [selected]="ans.reviewQuestionAnswerId===child.responseAnswerId">
              {{ans.answerDesc}}
            </button>
          </kendo-buttongroup>
        </div>
        <kendo-formerror *ngIf="formSubmited && !child.responseAnswerId">{{child.questionDesc}} response is
          required.</kendo-formerror>
        <div class="flex-col">
          <kendo-floatinglabel text="Exception Note">
            <kendo-textarea [fillMode]="formUiStyle.inputFillMode" [(ngModel)]="child.notes"
              [ngModelOptions]="{standalone: true}" aria-label="exception note description" name="Exception Note"
              [rows]="5" [cols]="40">
            </kendo-textarea>
            <kendo-formhint class="justify-content-end">{{child.notes?.length}}/250</kendo-formhint>
          </kendo-floatinglabel>
          <kendo-formerror *ngIf="formSubmited && child.answerCode==='YES' && child.notes?.length<1">Exception Note is required.</kendo-formerror>
        </div>
      </div>
    </div>
  </div>
  <div class="app-c-card app-c-card--border-box top-lg-space">
    <div class="flex-row">
      <div class="flex-col flex-col-8 align-items-center">
        <h4 class="mb-0 mt-0">Is the application accepted?</h4>
      </div>
      <div class="flex-col flex-col-4 text-right">
        <button kendoButton aria-label="application accepted yes" [primary]="true" (click)="isOpenAcceptanceClicked()">
          Yes
        </button>
        <button kendoButton aria-label="application accepted no" [primary]="true" class="ml-2"
          (click)="isOpenDenyClicked()">
          No
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Application Acceptance Modal Html-->
<kendo-dialog *ngIf="isOpenAcceptance" (close)="onCloseAcceptanceClicked()"
  class="app-c-modal app-c-modal-md app-c-modal-np">
  <kendo-dialog-titlebar> Application Accepted </kendo-dialog-titlebar>
  <case-management-accept-application (isCloseModalEvent)="onCloseAcceptanceClicked()" [isEdit]="isEdit"
    [clientCaseId]="clientCaseId"
    [clientCaseEligibilityId]="clientCaseEligibilityId"></case-management-accept-application>
</kendo-dialog>

<!-- Application Deny Modal Html-->
<kendo-dialog *ngIf="isOpenDeny" (close)="isCloseDenyClicked()" class="app-c-modal app-c-modal-sm app-c-modal-np">
  <kendo-dialog-titlebar> Deny application? </kendo-dialog-titlebar>
  <case-management-reject-application (isCloseDenyModal)="handleClosAfterDeny($event)"
    [clientCaseId]="clientCaseId"></case-management-reject-application>
</kendo-dialog>


<kendo-dialog *ngIf="isDenialLetter" (close)="denialPopupClose()" class="app-c-modal app-c-modal-sm app-c-modal-np"
  title="Notifications and Messages">

  <section class="k-dialog-body mb-2">
    <p>
      This feature is part of future scope of work for the ORCares project.
    </p>
  </section>
  <kendo-dialog-actions>
    <div class="justify-content-between">
      <div class="justify-content-end">
        <button kendoButton [primary]="true" aria-label="Cancel Add New Insurance Plan" look="outline"
          (click)="denialPopupClose()">
          Cancel
        </button>
        <button kendoButton [primary]="true" aria-label="Add New Insurance Plan" (click)="denialPopupClose()">
          Add
        </button>
      </div>
    </div>
  </kendo-dialog-actions>