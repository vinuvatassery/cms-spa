<kendo-dialog-titlebar (close)="closeAddEditPremiumsFormModalClicked()">
    <section class="app-l-mainTittle">
        <h1 class="maintitle_withicon text-bold">Edit Premium </h1>
    </section>
</kendo-dialog-titlebar>
<section class="add_main_popup_screen" *ngIf="insurancePremium$ | async as premium">


    <div class="add_new_top_section">
        <p class="mb-3"> Update the premium amount and add adjustments if needed.</p>
        <div class="flex-row">
            <div class="flex-col flex-col-6">
                <div class="detail-items-with-border mt-2">
                    <table>
                        <caption hidden> Provider Details</caption>
                        <tr hidden>
                            <th>Field</th>
                            <th> Details</th>
                        </tr>
                        <tr>
                            <td><strong>Client Name:</strong></td>
                            <td> {{premium.clientFullName}}</td>
                        </tr>
                        <tr>
                            <td><strong>Member ID:</strong></td>
                            <td>{{premium.clientId}}</td>
                        </tr>
                        <tr>
                            <td><strong>Insurance Vendor:</strong></td>
                            <td> {{premium.vendorName}} </td>
                        </tr>
                        <tr>
                            <td><strong>Plan Name:</strong></td>
                            <td>{{premium.insurancePlanName}} </td>
                        </tr>
                        <tr>
                            <td><strong>Insurance Type:</strong></td>
                            <td>{{premium.healthInsuranceType}}</td>
                        </tr>
                        <tr>
                            <td><strong>Coverage Start Date:</strong></td>
                            <td>{{premium.coverageStartDate  | date:'MM/dd/yyyy'}}</td>
                        </tr>
                        <tr>
                            <td><strong>Coverage End Date:</strong></td>
                            <td> {{premium.coverageEndDate  | date:'MM/dd/yyyy'}} </td>
                        </tr>
                        <tr>
                            <td><strong>Last Premium Due Date:</strong></td>
                            <td> {{premium.nextPremiumDueDate  | date:'MM/dd/yyyy'}} </td>
                        </tr>


                    </table>

                </div>

            </div>
        </div>

        <div class="flex-row">
            <div class="flex-col flex-col-3">
                <kendo-floatinglabel text="Premium Amount" class="amount-with-symbol">
                    <span class="k-input-prefix custom-currencysymbol"> $ </span>
                    <kendo-numerictextbox 
                        placeholder="Premium Amount" 
                        aria-label="Payment Amount"
                        class="input-icon-right" 
                        placeholder="00.00" 
                        [spinners]="false"
                        [fillMode]="formUiStyle.inputFillMode" 
                        format="c2" 
                        [min]="0"
                        [decimals]="2"
                        [maxlength]="15"
                        [ngClass]="{'ng-invalid ng-dirty':premium.premiumAmountRequired}"
                        (valueChange)="premiumAmountChanged()"
                        [(ngModel)]="premium.premiumAmount">
                    </kendo-numerictextbox>
                    <kendo-formerror *ngIf="premium.premiumAmountRequired">
                        Premium Amount is required
                    </kendo-formerror>
                </kendo-floatinglabel>
            </div>
            <div class="flex-col flex-col-3">
                <span class="app-checkboxwidtext-wrapper mt-4">
                    <input 
                        kendoCheckBox              
                        type="checkbox" 
                        id="spots-payment" 
                        name="spots-payment"
                        aria-labelledby="SPOTSpayment"
                        [(ngModel)]="premium.isSpotsPayment"/>
                    <label class="k-checkbox-label" for="SPOTSpayment">This is a SPOTS payment</label>
                </span>
            </div>
        </div>

    </div>


    <div class="add_new_bottom_section">
        <div class="flex-row">
            <div class="flex-col flex-col-6">
                <div class=" mb-3">
                <div  *ngFor="let adjustment of premium.premiumAdjustments;index as i" class="mb-2">   
                    <div class="flex-space-bw align-items-center">
                        <h4 class="mar-0">ADJUSTMENT {{i+1}}</h4>
                        <button class="" kendoButton fillMode="flat" aria-label="Delete" themeColor="error" (click)="deleteAdjustment(i)">DELETE</button>
                    </div>
                    <div class="flex-row">
                        <div class="flex-col flex-col-2">
                            <div class="mt-3">
                            <kendo-buttongroup selection="single" class="height-btn">
                                <button 
                                kendoButton 
                                [toggleable]="true" 
                                aria-label="Positive" 
                                title="Positive"
                                themeColor="light" 
                                [selected]="adjustment.isPositiveAdjustment ?? true"
                                (selectedChange)="changeAdjustmentSign(true, adjustment)">
                                    <span class="material-icons" aria-hidden="false">add</span>
                                </button>
                                <button 
                                kendoButton 
                                [toggleable]="true"  
                                themeColor="light" 
                                aria-label="Negative" 
                                title="Negative"
                                [selected]="!(adjustment.isPositiveAdjustment ?? true)"
                                (selectedChange)="changeAdjustmentSign(false, adjustment)">
                                    <span class="material-icons" aria-hidden="false">remove</span>
                                </button>
                            </kendo-buttongroup>
                        </div>
                        </div>
                        <div class="flex-col flex-col-5">
                            <kendo-floatinglabel text="Amount" class="amount-with-symbol">
                                <span class="k-input-prefix custom-currencysymbol"> $ </span>
                                <kendo-numerictextbox 
                                placeholder="Amount" 
                                aria-label="Amount" 
                                [spinners]="false"
                                class="input-icon-right" 
                                placeholder="00.00" 
                                [spinners]="false"
                                [fillMode]="formUiStyle.inputFillMode" 
                                format="c2"                                 
                                [decimals]="2"
                                [maxlength]="15"
                                [fillMode]="formUiStyle.inputFillMode"
                                [ngClass]="{'ng-invalid ng-dirty':adjustment.adjustmentAmountRequired}"
                                (valueChange)="adjustmentAmountChanged(adjustment)"
                                [(ngModel)]="adjustment.adjustmentAmount"
                               >
                                </kendo-numerictextbox>
                                <kendo-formerror *ngIf="adjustment.adjustmentAmountRequired">
                                    Amount is required
                                </kendo-formerror>
                            </kendo-floatinglabel>
                        </div>
                        <div class="flex-col flex-col-5">
                            <kendo-floatinglabel text="Coverage Dates">
                                <kendo-dropdownlist 
                                [fillMode]="formUiStyle.dropDownFillMode"
                                placeholder="Coverage Date"
                                [data]="coverageDateList"
                                textField="coverageDate" 
                                valueField="coverageStartDate"
                                [valuePrimitive]="true"
                                [ngClass]="{'ng-invalid ng-dirty':(adjustment.coverageDatesRequired || adjustment.duplicateCoverage)}"
                                (valueChange)="adjustmentDateChanged(adjustment)"
                                [(ngModel)]="adjustment.coverageStartDate"
                                >
                            </kendo-dropdownlist>
                            <kendo-formerror *ngIf="adjustment.coverageDatesRequired">
                                Coverage Dates is required
                            </kendo-formerror>
                            <kendo-formerror *ngIf="adjustment.duplicateCoverage">
                                Coverage Dates already exist
                            </kendo-formerror>
                          </kendo-floatinglabel>
                        </div>
                    </div>
                </div>
                    <div class="mt-2">
                        <button 
                        class="" 
                        kendoButton 
                        fillMode="flat" 
                        themeColor="primary"
                        (click)="addAdjustment()"> 
                        <span class="material-icons" aria-label="New Premiums" aria-hidden="false">add</span> ADJUSTMENT</button>
                    </div>
                </div>
            </div>
        </div>

    </div>


</section>
<div class="add_new_fixed_bottom" *ngIf="insurancePremium$ | async">
    <div>
        <h5 class="text-upper">Recent Premiums for this client</h5>
        <div class="add_new_fixed_bottom_grid_section">
            <cms-financial-premiums-recent-premiums-list [vendorId]="vendorId" [clientId]="clientId" [premiumsType]="premiumsType"></cms-financial-premiums-recent-premiums-list>
        </div>
        <div class="d-flex align-items-center mt-1">
            <button kendoButton [primary]="true" aria-label="Update"  (click)="save()"> Update </button>
            <button kendoButton [primary]="true" look="outline" class="ml-2" aria-label="Cancel" (click)="closeAddEditPremiumsFormModalClicked()"> Cancel </button>
        </div>
    </div>

</div>
<section class="add_main_popup_screen" *ngIf="!(insurancePremium$ | async)">
    <div class="add_new_top_section">
        <p class="mb-3"> Update the premium amount and add adjustments if needed.</p>
        <div class="flex-row">
            <div class="flex-col flex-col-6">
                <div class="detail-items-with-border mt-2">
                    <table>
                        <caption hidden> Provider Details</caption>
                        <tr hidden>
                            <th>Field</th>
                            <th> details</th>
                        </tr>
                        <tr>
                            <td><strong>Client Name:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Member ID:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Insurance Vendor:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Plan Name:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Insurance Type:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Coverage Start Date:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Coverage End Date:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                        <tr>
                            <td><strong>Last Premium Due Date:</strong></td>
                            <td> <kendo-skeleton shape="text" animation="pulse" width="30%"></kendo-skeleton></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="flex-row">
            <div class="flex-col flex-col-3">
                <kendo-floatinglabel text="" class="amount-with-symbol">
                    <span class="k-input-prefix custom-currencysymbol"> $ </span>
                    <kendo-skeleton shape="text" animation="pulse" width="60%" height="50px"></kendo-skeleton>
                </kendo-floatinglabel>
            </div>
            <div class="flex-col mt-1">
                <p>This will update the premium amount going forward</p>
            </div>
        </div>

    </div>
</section>
